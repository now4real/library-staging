!function e(s,r,o){function u(n,t){if(!r[n]){if(!s[n]){var i="function"==typeof require&&require;if(!t&&i)return i(n,!0);if(a)return a(n,!0);throw(t=new Error("Cannot find module '"+n+"'")).code="MODULE_NOT_FOUND",t}i=r[n]={exports:{}},s[n][0].call(i.exports,function(t){return u(s[n][1][t]||t)},i,i.exports,e,s,r,o)}return r[n].exports}for(var a="function"==typeof require&&require,t=0;t<o.length;t++)u(o[t]);return u}({1:[function(t,n,i){Object.defineProperty(i,"t",{value:!0});t=t(3);function e(){}e.h="CORE",e.S=t.O.Warn,e.P=Number("5"),e.C=Number("6"),e.T=void 0,e.N=void 0,e.D=void 0,e._=void 0,e.I="https",e.M="443",e.A="FELS",e.R="n4rCommon",e.U=["now4real.com","localhost:3000","localtest.me:3000"],e.j="shared-public-sandbox.test",e.L=!0,e.F=140,e.G=0,e.J=1500,e.H=5e3,e.V=3e5,e.W=15e3,e.B=8e3,e.q=1e3,e.Y="n4rSitePreferences",e.K="noRe",e.X="noReMain",e.$="email",e.Z="emailMain",e.tt=1e3,i.default=e},{3:3}],2:[function(t,n,i){Object.defineProperty(i,"t",{value:!0}),i.nt=i.it=i.et=i.st=void 0;t=t(3),i.st=t.O.Debug,i.et=t.O.Info,i.it=t.O.Warn,i.nt=t.O.Error,e.rt="presenceForeground",e.ot="presenceTyping",e.ut="messageUserList",e.ct="messageEvent",e.ht="events",e.lt="key",e.ft="command",e.dt="ADD",e.UPDATE="UPDATE",e.vt="DELETE",e.wt="http",e.gt="https",e.bt="localhost",e.Et="CONNECTED",e.DISCONNECTED="DISCONNECTED",e.St="DISCONNECTED:WILL-RETRY",e.Ot="DISCONNECTED:TRYING-RECOVERY",e.Pt="code",e.Ct="message",e.Tt="on",e.Nt="off",e.Dt="yes",e._t="no",e.yt="page",e.It="site",e.Mt="\t",e.At="/",e.Rt="g.invalid",e.Ut="n4rAuth",e.xt="n4rFels",e.kt="translate.goog",e.jt="MODERATOR",e.Lt="GUEST",e.EMAIL="EMAIL",e.Ft="group.invalid",e.Gt="master.invalid",e.Jt="resolve",e.Ht="reject",e.Vt="SITE_CONFIGURATION_CHANGED",e.Wt="SITE_NOT_ACTIVE",t=e;function e(){}i.default=t},{3:3}],3:[function(t,n,i){var e;Object.defineProperty(i,"t",{value:!0}),i.Bt=i.qt=i.Yt=i.zt=i.Kt=i.O=i.Xt=void 0,(e=i.Xt||(i.Xt={}))[e.FACEBOOK=0]="FACEBOOK",e[e.GOOGLE=1]="GOOGLE",e[e.LINKEDIN=2]="LINKEDIN",e[e.TWITTER=3]="TWITTER",(e=i.O||(i.O={}))[e.Debug=1]="Debug",e[e.Info=2]="Info",e[e.Warn=3]="Warn",e[e.Error=4]="Error",e[e.Off=5]="Off",(e=i.Kt||(i.Kt={}))[e.MESSAGE_SEND=0]="MESSAGE_SEND",e[e.MESSAGE_GET=1]="MESSAGE_GET",e[e.MESSAGE_DELETE=2]="MESSAGE_DELETE",e[e.CHAT_FLUSH=3]="CHAT_FLUSH",e[e.CHAT_ENABLE=4]="CHAT_ENABLE",e[e.MUTE_USER_GET=5]="MUTE_USER_GET",e[e.MUTE_USER_SET=6]="MUTE_USER_SET",e[e.DELETE_PASSWORD=7]="DELETE_PASSWORD",e[e.GET_AUTH_INFO=8]="GET_AUTH_INFO",e[e.REPORT_CHAT_MESSAGE=9]="REPORT_CHAT_MESSAGE",e[e.USER_PREFERENCE_SET=10]="USER_PREFERENCE_SET",e[e.LOG=11]="LOG",e[e.USER_CONSENT_SET=12]="USER_CONSENT_SET",e[e.JWT_REFRESH=13]="JWT_REFRESH",e[e.POLL_NEW=14]="POLL_NEW",e[e.POLL_CLOSE=15]="POLL_CLOSE",e[e.POLL_VOTE_SET=16]="POLL_VOTE_SET",e[e.POLL_VOTE_GET=17]="POLL_VOTE_GET",(e=i.zt||(i.zt={}))[e.Success=0]="Success",e[e.Generic=-1]="Generic",e[e.Unauthorized=-2]="Unauthorized",e[e.IllegalArgument=-3]="IllegalArgument",e[e.TemporarilyUnavailable=-4]="TemporarilyUnavailable",e[e.UnsupportedClient=-5]="UnsupportedClient",e[e.UnsupportedBrowser=-6]="UnsupportedBrowser",e[e.AuthenticationExpired=-7]="AuthenticationExpired",(e=i.Yt||(i.Yt={}))[e.WrongCredentials=1]="WrongCredentials",e[e.AllowedSessionCountReached=7]="AllowedSessionCountReached",e[e.SessionCountLimitReached=8]="SessionCountLimitReached",e[e.ServerTooBusy=9]="ServerTooBusy",e[e.ServerBlocked=10]="ServerBlocked",(e=i.qt||(i.qt={})).SOCIAL="Social",e.JWT="JWT",e.READ_ONLY="Read-only",e.N4R="N4R",e.NO_REGISTRATION="NoRe",e.EMAIL="Email",(e=i.Bt||(i.Bt={})).PageShowing="page_showing",e.PageHiding="page_hiding",e.ConnectionStatus="connection_status",e.Authentication="authentication",e.Load="load",e.LoadError="load_error",e.UserUpdated="user_updated"},{}],4:[function(t,n,i){Object.defineProperty(i,"t",{value:!0}),i.$t=void 0;var e=t(43),t=t(44);i.$t=new e.default(t.Qt.CREDIT_EXHAUSTED,"The credits for this site have been exhausted or this site was disabled. Please check your Now4real dashboard at dashboard.now4real.com to upgrade your plan and/or re-enable Now4real")},{43:43,44:44}],5:[function(t,n,i){Object.defineProperty(i,"t",{value:!0});t=t(40);i.default=new t.default},{40:40}],6:[function(t,n,i){Object.defineProperty(i,"t",{value:!0});var o=t(35),u=t(2),a=t(43),c=t(44),e=t(29),s=t(39),h=t(4);function r(t,n,i){void 0===i&&(i=!1),this.Zt=t,this.tn=n,this.nn=i}r.prototype.parse=function(t){t=JSON.parse(t);return{status:t.s,master:t.m,group:t.g,logo:t.l,version:t.v,siteKey:t.k,auth:t.a,whiteLabel:t.w,conf:t.c}},r.prototype.check=function(){var r=this;return new Promise(function(e,s){r.fetch(r.Zt).then(function(t){var n=t.en,t=t.responseText;o.default(u.st,"Obtained",n,t);try{var i=r.parse(t);0===i.status?s(h.$t):(r.current=i,e(i))}catch(t){s(new a.default(c.Qt.TECHNICAL_PROBLEM,t.message))}}).catch(function(t){o.default(u.st,t.statusCode),403!==t.statusCode||r.nn?s(t):(t=r.parse('{"s":1,"v":-1}'),r.current=t,e(t))})})},r.prototype.sn=function(t){var n=this;return t?(t=this.parse(JSON.stringify(t)),this.current=t,Promise.resolve(t)):s.retry(function(){return n.check()},{rn:"statusCode",on:"*",un:3,delay:5e3}).catch(function(t){throw t.statusCode?new a.default(c.Qt.TECHNICAL_PROBLEM,t.statusCode.toString()):t})},r.prototype.fetch=function(t){return e.default.an(this.tn+"/conf/"+encodeURIComponent(t)+"/json")},r.prototype.get=function(){return this.current},r.prototype.cn=function(){var t=this.current;return{s:t.status,m:t.master,g:t.group,l:t.logo,v:t.version,k:t.siteKey,a:t.auth,w:t.whiteLabel,c:t.conf}},r.prototype.update=function(t){try{return this.current=this.parse(t),this.current}catch(t){o.default(u.nt,"Conf update error",t)}},i.default=r},{2:2,29:29,35:35,39:39,4:4,43:43,44:44}],7:[function(t,n,i){function e(){}Object.defineProperty(i,"t",{value:!0}),e.hn=!1,e.ln=null,e.dn=null,e.vn=null,i.default=e},{}],8:[function(t,n,i){var s=this&&this.__spreadArrays||function(){for(var t=0,n=0,i=arguments.length;n<i;n++)t+=arguments[n].length;for(var e=Array(t),s=0,n=0;n<i;n++)for(var r=arguments[n],o=0,u=r.length;o<u;o++,s++)e[s]=r[o];return e},r=(Object.defineProperty(i,"t",{value:!0}),t(41));function e(t){if(this.wn=!1,this.mn=[],this.prefix=t.prefix,this.context=t.context,this.category=t.category,this.pn=t.gn,this.mode=t.bn,this.En=t.En,this.hidden=t.Sn||!1,this.On=t.On||!1,this.Pn=t.Pn||!1,void 0!==this.context){var n="";switch(this.context){case 0:n="p";break;case 1:n="s";break;case 2:n=2===this.category?"w|"+this.pn[0]:"w";break;case 3:n=this.En}this.id=this.prefix+"|"+n}else this.id=this.prefix;this.Pn&&(this.id=this.id+="|"+this.pn.join(",")),this.Cn=t.Cn?r.Tn(t.Cn):null}e.prototype.toString=function(){return this.id},e.prototype.Nn=function(){return this.mn},e.prototype.Dn=function(t){-1===this.mn.indexOf(t)&&this.mn.push(t)},e.prototype._n=function(t){t=this.mn.indexOf(t);-1<t&&this.mn.splice(t,1)},e.prototype.yn=function(t){this.snapshot=r.Tn(this.Cn),t[this.name]=this.snapshot,this.wn=!0},e.prototype.In=function(t,n){var i=this.snapshot;if(null==t)i=t;else if(r.isArray(t))r.isArray(i)?i.splice.apply(i,s([0,i.length],t)):i=t;else if(r.Mn(t))if(r.Mn(i)){for(var e in t)i[e]=t[e];for(var e in i)e in t||delete i[e]}else i=t;else i=t;this.snapshot=i,n[this.name]=i},e.prototype.An=function(t){this.In(void 0,t),this.wn=!1},e.prototype.Rn=function(t){this.In(this.Cn,t)},e.prototype.Un=function(t){this.listener=t},e.prototype.xn=function(){this.listener=void 0},e.prototype.kn=function(){return this.hidden},e.prototype.jn=function(){return this.wn},e.prototype.Ln=function(){return this.On},e.prototype.Fn=function(){return void 0!==this.En},e.prototype.Gn=function(){return 3===this.context},i.default=e},{41:41}],9:[function(t,n,i){Object.defineProperty(i,"t",{value:!0});var s=t(8),e=t(2),r=t(44),o=t(35),u=t(2);function a(){var t;this.Jn=["p"],this.Hn=["ml","md","mlm","cd","mh","gr","mv"],this.Vn=["t"],this.Wn=[e.default.lt,e.default.ft,"u","i","p","r","s","d"],this.Bn=[e.default.lt,e.default.ft,"n","i","p","r","b","bf","bb"],this.qn=[e.default.lt,"d"],this.Yn=["c"],this.zn=[e.default.lt,e.default.ft,"i","t","c","p"],this.Kn=["c","h"],this.Xn=[e.default.lt,e.default.ft],this.$n=["q","o","v","t","m","b"],this.Qn=["q","m"],this.Zn={value:null},this.ti=[],this.ni={},this.ii=[],this.ei=[],this.si=null,this.ri={status:null},this.oi={status:"NOT_AUTHENTICATED"},this.ui={messageMaxLength:null,messageMaxLengthModerator:null,messageMaxLengthGuest:null,messageDurationValue:null,messageDurationUnit:null,chatStatus:null,clickableLinks:null,gifsStatus:null},this.ai=[r.ci.COUNTER_PAGE_VIEWERS,r.ci.COUNTER_PAGE_CHATTERS,r.ci.COUNTER_CHAT_TYPING],this.hi=((t={})[r.ci.CONNECTION_STATUS]=new s.default({category:0,Cn:this.ri,prefix:"_cs",On:!0}),t[r.ci.LOGIN_STATUS]=new s.default({category:0,Cn:this.oi,prefix:"_ls",On:!0}),t[r.ci.AUTHORIZATION]=new s.default({category:0,Cn:{},prefix:"_a",On:!0}),t[r.ci.PARAMETERS]=new s.default({category:9,Cn:this.ui,prefix:"Par",On:!0,gn:this.Hn,bn:"MERGE"}),t[e.default.ht]=new s.default({category:10,prefix:"E",On:!1,gn:this.Vn,bn:"DISTINCT"}),t[e.default.rt]=new s.default({category:1,context:0,Sn:!0,prefix:"PF",gn:this.Jn,bn:"RAW"}),t[e.default.ot]=new s.default({category:1,context:0,Sn:!0,prefix:"PT",gn:this.Jn,bn:"RAW"}),t[e.default.ut]=new s.default({category:7,Sn:!0,prefix:"Mu",gn:this.Bn,bn:"COMMAND"}),t[e.default.ct]=new s.default({category:8,Sn:!0,prefix:"Me",gn:this.qn,bn:"DISTINCT"}),t[r.ci.RANKING_PAGE_VIEWERS]=new s.default({category:4,context:0,Cn:this.ti,prefix:"RF",gn:this.zn,bn:"COMMAND"}),t[r.ci.RANKING_PAGE_CHATTERS]=new s.default({category:4,context:0,Cn:this.ti,prefix:"RA",gn:this.zn,bn:"COMMAND"}),t.RANKING_SITE_VIEWERS=new s.default({category:4,context:2,Sn:!0,Cn:this.ti,prefix:"RsF",gn:this.zn,bn:"COMMAND"}),t.RANKING_SITE_CHATTERS=new s.default({category:4,context:2,Sn:!0,Cn:this.ti,prefix:"RsA",gn:this.zn,bn:"COMMAND"}),t[r.ci.LIST_CHAT_TYPING]=new s.default({category:6,context:0,Cn:this.ei,prefix:"LT",gn:this.Xn,bn:"COMMAND"}),t[r.ci.LIST_CHAT_MESSAGES]=new s.default({category:3,context:0,Cn:this.ii,prefix:"M",gn:this.Wn,bn:"COMMAND"}),t[r.ci.COUNTER_PAGE_VIEWERS]=new s.default({category:2,context:0,Cn:this.Zn,prefix:"CF",gn:this.Yn,bn:"MERGE"}),t[r.ci.COUNTER_PAGE_CHATTERS]=new s.default({category:2,context:0,Cn:this.Zn,prefix:"CA",gn:this.Yn,bn:"MERGE"}),t[r.ci.COUNTER_SITE_VIEWERS]=new s.default({category:2,context:1,Cn:this.Zn,prefix:"CF",gn:this.Yn,bn:"MERGE"}),t[r.ci.COUNTER_SITE_CHATTERS]=new s.default({category:2,context:1,Cn:this.Zn,prefix:"CA",gn:this.Yn,bn:"MERGE"}),t[r.ci.COUNTER_CHAT_MESSAGES]=new s.default({category:2,context:0,Cn:this.Zn,prefix:"CM",gn:this.Yn,bn:"MERGE"}),t[r.ci.COUNTER_CHAT_TYPING]=new s.default({category:2,context:0,Cn:this.Zn,prefix:"CT",gn:this.Yn,bn:"MERGE"}),t.COUNTER_DOMAINS_GLOBAL=new s.default({category:2,context:2,Sn:!0,Cn:this.Zn,prefix:"Ga",gn:["hc"],bn:"MERGE"}),t.COUNTER_CHAT_MESSAGES_GLOBAL=new s.default({category:2,context:2,Sn:!0,Cn:this.Zn,prefix:"Ga",gn:["mc"],bn:"MERGE"}),t.COUNTER_USERS_GLOBAL=new s.default({category:2,context:2,Sn:!0,Cn:this.Zn,prefix:"Ga",gn:["uc"],bn:"MERGE"}),t.PEAK_SITE_VIEWERS=new s.default({category:2,context:1,Sn:!0,Cn:this.Zn,prefix:"CpF",gn:this.Yn,bn:"MERGE"}),t.PEAK_SITE_CHATTERS=new s.default({category:2,context:1,Sn:!0,Cn:this.Zn,prefix:"CpA",gn:this.Yn,bn:"MERGE"}),t[r.ci.HEATMAP_PAGE_VIEWERS]=new s.default({category:5,context:0,Cn:this.ni,prefix:"HF",gn:this.Kn,bn:"MERGE"}),t[r.ci.HEATMAP_SITE_VIEWERS]=new s.default({category:5,context:1,Cn:this.ni,prefix:"HF",gn:this.Kn,bn:"MERGE"}),t[r.ci.POLL]=new s.default({category:12,Cn:this.si,prefix:"Po",gn:this.$n,bn:"MERGE",Pn:!0}),t[r.ci.POLL_STATUS]=new s.default({category:11,Cn:this.si,prefix:"Po",gn:this.Qn,bn:"MERGE",Pn:!0}),t)}a.li=function(){return a.fi=a.fi?a.fi:new a},a.prototype.di=function(t){t=t.id;o.default(u.st,"Destroying: "+t),delete this.hi[t]},a.prototype.find=function(t){var n=t.split(":"),i=n[0],n=n[1],e=this.hi[i];return e&&void 0===e.name&&(this.hi[i].name=i),void 0!==n&&-1<this.ai.indexOf(i)?(o.default(u.st,"Custom page context founded: "+n),i=e.prefix+"|"+n,this.hi[i]||(o.default(u.st,"Generating: "+t),(n=new s.default({category:e.category,Cn:e.Cn,prefix:e.prefix,gn:e.pn,bn:e.mode,context:3,En:n})).name=t,this.hi[i]=n)):e},a.prototype.vi=function(){var n=this;return Object.keys(this.hi).filter(function(t){return!0===n.hi[t].On}).map(function(t){return n.find(t)})},a.prototype.wi=function(t){for(var n in this.hi)if(this.hi[n].toString()===t)return this.hi[n]},a.prototype.mi=function(){var n=this;return Object.keys(this.hi).filter(function(t){return!0!==n.hi[t].kn()})},i.default=a},{2:2,35:35,44:44,8:8}],10:[function(t,n,i){Object.defineProperty(i,"t",{value:!0}),i.pi=i.gi=i.bi=i.Ei=i.Si=i.Oi=i.Pi=i.Ci=i.Ti=i.test=void 0;var e=t(35),s=t(2);function r(){var t,n;return void 0!==document.hidden?(t="hidden",n="visibilitychange"):void 0!==document.mozHidden?(t="mozHidden",n="mozvisibilitychange"):void 0!==document.msHidden?(t="msHidden",n="msvisibilitychange"):void 0!==document.webkitHidden&&(t="webkitHidden",n="webkitvisibilitychange"),{hidden:t,visibilityChange:n}}function o(){return"postMessage"in window}function u(){return window.storageAvailable}function a(t,n){var i=(t="on"+t)in n;return i||(n=n.setAttribute?n:document.createElement("div")).setAttribute&&n.removeAttribute&&(n.setAttribute(t,""),i="function"==typeof n[t],void 0!==n[t]&&(n[t]=void 0),n.removeAttribute(t)),i}i.test=function(t){switch(t){case 1:return a("message",window)&&o();case 0:return a("storage",window)&&u();case 2:var n=r().hidden;return void 0!==document[n];default:return e.default(s.it,"Unsupported feature",t),!1}},i.Ti=r,i.Ci=o,i.Pi=u,i.Oi=a,i.Si=function(){return-1!==(t=navigator.userAgent,n=-1,"Microsoft Internet Explorer"===navigator.appName?null!==new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(t)&&(n=parseFloat(RegExp.$1)):"Netscape"===navigator.appName&&null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(t)&&(n=parseFloat(RegExp.$1)),n);var t,n},i.Ei=function(){return 0<=navigator.userAgent.indexOf("Edge")},i.bi=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},i.gi=function(){return/Version\/.{1,300}Chrome\/\d+\.\d+\.\d+\.\d+|; wv\).{1,300}Chrome\/\d+\.\d+\.\d+\.\d+|(?:iPod|iPod touch|iPhone|iPad);.{0,30}CPU.{0,30}OS[ +]\d+_\d+(?:_\d+|).{0,30} AppleNews\/\d+\.\d+(?:\.\d+|)|(?:iPod|iPhone|iPad).{1,200}Version\/\d+\.\d+(?:\.\d+|)(?!.{0,200} Safari)|(?:iPod|iPod touch|iPhone|iPad)(?!.{0,200} Safari)/.test(navigator.userAgent)},i.pi=function(){return e.default(s.st,"UA: "+navigator.userAgent),/bot|crawler|spider/i.test(navigator.userAgent)}},{2:2,35:35}],11:[function(t,n,i){Object.defineProperty(i,"t",{value:!0}),i.default=function(){window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),String.prototype.startsWith||(String.prototype.startsWith=function(t){return this.substr(0,t.length)===t}),String.prototype.endsWith||(String.prototype.endsWith=function(t){return-1!==this.indexOf(t,this.length-t.length)}),String.prototype.Ni||(String.prototype.Ni=function(){return this.charAt(0).toUpperCase()+this.slice(1)})}},{}],12:[function(t,n,i){Object.defineProperty(i,"t",{value:!0});var e=t(1),o=t(43),s=t(7),u=t(2),r=t(41);function a(t){this.Di=0,this._i={},this.yi=r.Ii(8),this.destination=t,this.origin=t!==a.Mi||void 0!==e.default.D.file_name?"*":s.default.Ai,this.Ri()}a.prototype.Ui=function(){return this.yi+this.Di++},a.prototype.Ri=function(){function t(t){var n,i,e,s;(t.origin||t.originalEvent.origin)!==r.origin||(n=(t=t.data).cmd)!==u.default.Jt&&n!==u.default.Ht||(i=t.id,e=t.payload,n===u.default.Ht&&(s=t.code,t=t.message,s)&&t&&(e=new o.default(s,t)),null!=(s=r._i[i])&&s[n](e),delete r._i[i])}var r=this;window.addEventListener("message",t,!1),this.xi=t},a.prototype.send=function(t){var i=this,e=this.Ui();return this.destination.postMessage({id:e,cmd:t.cmd,payload:t.payload},this.origin),new Promise(function(t,n){i._i[e]={resolve:t,reject:n}})},a.prototype.reset=function(){for(var t=this.Di=0,n=Object.keys(this._i);t<n.length;t++){var i=n[t];this._i[i].reject(new o.default("ABORTED","broken channel")),delete this._i[i]}window.removeEventListener("message",this.xi)},a.Mi=window.parent,a.ki=window,i.default=a},{1:1,2:2,41:41,43:43,7:7}],13:[function(t,n,i){function e(t,n){this.cmd=t,this.payload=n}var s,r,o=this&&this.__extends||(s=function(t,n){return(s=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,n){t.__proto__=n}:function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])}))(t,n)},function(t,n){function i(){this.constructor=t}s(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}),u=(Object.defineProperty(i,"t",{value:!0}),i.ji=i.Li=i.Fi=i.Gi=i.Ji=void 0,o(a,r=i.Ji=e),a);function a(t){return r.call(this,"verify",t)||this}i.Gi=u;o(h,c=e);var c,u=h;function h(t,n,i){return c.call(this,"reload",{startOpen:t,updatedSiteConf:n,reloadScriptConf:i})||this}i.Fi=u;o(f,l=e);var l,u=f;function f(){return l.call(this,"getUpdatedJWT",null)||this}i.Li=u;o(v,d=e);var d,u=v;function v(t){return d.call(this,"updateConfig",{c:t})||this}i.ji=u},{}],14:[function(t,n,i){function e(t,n){this.cmd=t,this.payload=n}var s,r,o=this&&this.__extends||(s=function(t,n){return(s=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,n){t.__proto__=n}:function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])}))(t,n)},function(t,n){function i(){this.constructor=t}s(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}),u=(Object.defineProperty(i,"t",{value:!0}),i.Hi=i.Vi=i.Wi=i.Bi=i.qi=i.Yi=i.zi=i.Ki=void 0,o(a,r=i.Ki=e),a);function a(t){return r.call(this,"load",t)||this}i.zi=u;o(h,c=e);var c,u=h;function h(t){return c.call(this,"error",t)||this}i.Yi=u;o(f,l=e);var l,u=f;function f(t){return l.call(this,"subjectUpdate",t)||this}i.qi=u;o(v,d=e);var d,u=v;function v(t){return d.call(this,"response",t)||this}i.Bi=u;o(m,w=e);var w,u=m;function m(t){return w.call(this,"loggerEdit",t)||this}i.Wi=u;o(g,p=e);var p,u=g;function g(t){return p.call(this,"siteStatusUpdate",t)||this}i.Vi=u;o(E,b=e);var b,u=E;function E(t){return b.call(this,"suggestionsUpdate",t)||this}i.Hi=u},{}],15:[function(t,n,i){function e(t,n){this.type=t,this.data=n,this.timestamp=Date.now()}var s,r,o=this&&this.__extends||(s=function(t,n){return(s=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,n){t.__proto__=n}:function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])}))(t,n)},function(t,n){function i(){this.constructor=t}s(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}),u=(Object.defineProperty(i,"t",{value:!0}),i.Xi=i.$i=i.Qi=i.Zi=i.te=i.ne=i.ie=i.ee=i.se=i.re=i.oe=i.ue=void 0,t(44)),t=(i.ue=e,o(a,r=e),a);function a(t){return r.call(this,u.ci.CONNECTION_STATUS,t)||this}i.oe=t;o(h,c=e);var c,t=h;function h(t){return c.call(this,u.ci.LOGIN_STATUS,t)||this}i.re=t;o(f,l=e);var l,t=f;function f(t){return l.call(this,u.ci.AUTHORIZATION,t)||this}i.se=t;o(v,d=e);var d,t=v;function v(t){return d.call(this,u.ci.LIST_CHAT_MESSAGES,t)||this}i.ee=t;o(m,w=e);var w,t=m;function m(t){return w.call(this,u.ci.PARAMETERS,t)||this}i.ie=t;o(g,p=e);var p,t=g;function g(t){return p.call(this,u.ci.LIST_CHAT_TYPING,t)||this}i.ne=t;o(E,b=e);var b,t=E;function E(t){return b.call(this,u.ci.POLL,t)||this}i.te=t;o(O,S=e);var S,t=O;function O(t){return S.call(this,u.ci.POLL_STATUS,t)||this}i.Zi=t;o(C,P=e);var P,t=C;function C(t,n){return P.call(this,t,n)||this}i.Qi=t;o(N,T=e);var T,t=N;function N(t,n){return T.call(this,t,n)||this}i.$i=t;o(_,D=e);var D,t=_;function _(t,n){return D.call(this,t,n)||this}i.Xi=t},{44:44}],16:[function(t,n,i){Object.defineProperty(i,"t",{value:!0}),new(t(17).ae)},{17:17}],17:[function(V,t,W){!function(H){!function(){var l=this&&this.__assign||function(){return(l=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++)for(var s in n=arguments[i])Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s]);return t}).apply(this,arguments)},f=(Object.defineProperty(W,"t",{value:!0}),W.ae=void 0,V(1)),d=V(2),v=V(7),w=V(3),m=V(41),t=V(34),n=V(42),p=V(21),g=V(26),b=V(27),E=V(28),S=V(25),e=V(37),s=V(36),r=V(32),o=V(9),O=V(18),u=V(11),P=V(15),a=V(14),c=V(13),i=V(23),h=V(10),C=V(5),k=V(30),j=V(31),T=V(6),N=V(19),L=V(20),F=V(24),D=V(12),G=V(39),_=V(43),y=V(45),I=V(44),M=V(35),A=V(3),R=V(2),U="undefined"!=typeof window?window.LS:void 0!==H?H.LS:null,J=(x.prototype.start=function(){M.default(R.et,U.LightstreamerClient.LIB_VERSION);try{this.ce();for(var t=this.hi.vi(),n=0,i=t;n<i.length;n++)i[n].yn(this);this.le.he()&&this.load()}catch(t){throw new _.default(I.Qt.TECHNICAL_PROBLEM,t.message)}},x.prototype.fe=function(t){M.default(R.st,"updateIntegratorStatus",t);var n=t.status,i=t.logo,t=t.whiteLabel;this.de=n,this._siteStatus=n,this._customLogo=void 0!==i?!!i:3===n,this._whiteLabel=void 0!==t&&t},x.prototype.ve=function(t){var n=f.default.T.target;"api"!==n&&"api+widget"!==n&&"demo"!==n||this.notify(new a.Yi(t),"p"),"widget"!==n&&"api+widget"!==n&&"demo"!==n||m.we(this.onerror)&&this.onerror.call(this,t),this.me(),C.default.publish(w.Bt.LoadError,t)},x.prototype.me=function(){this.notify(new a.Ki("destroy",{}),"p")},x.prototype.pe=function(){var t,n=f.default.T.target;"api"!==n&&"api+widget"!==n&&"demo"!==n||((t=JSON.parse(f.default.N)).technicalConfig=f.default.D,t={cc:JSON.stringify(t),as:this.hi.mi(),ll:f.default.S,ago:f.default.ge,co:f.default.be,uau:f.default.Ee,ss:this.de,lv:this.version,pc:this.context.Se,sc:this.context.Zt,gc:this.context.Oe,wv:this.Pe,nrm:this.Ce,em:this.Te,sk:null==(t=this.Ne.get())?void 0:t.siteKey,wll:this._whiteLabel,pars_snap:this.hi.find(I.ci.PARAMETERS).snapshot},this.notify(new a.zi(t),"p")),"widget"!==n&&"api+widget"!==n&&"demo"!==n||(this._fromFile=void 0!==f.default.D.file_name,this._standardAuthDisabled=this.Pe,this.De)||this.onload.call(this),C.default.publish(w.Bt.Load,null)},x.prototype._e=function(t){t=window[t];this.onload=t&&m.we(t.onload)?t.onload:function(){M.default(R.nt,"onload not setted")},this.onerror=t?t.onerror:null},x.prototype.ye=function(){if("file:"===location.protocol)return!0;for(var t=f.default.U,n=m.Ie(window.location.href).host,i=0,e=t;i<e.length;i++){var s=e[i];if(n.endsWith(s))return!0}return M.default(R.nt,"the domain is not enabled",n,t,window.location.href),!1},x.prototype.Me=function(t){var n=this;N.default.init(t),this.Ae(),N.default.Re(function(t){n.xe.Ue(N.default.ke()),n.Ae()}),this.xe.Ue(N.default.ke())},x.prototype.je=function(t){var i,e,n,s=this,r=f.default.T,o=t.status,u=t.master,a=t.group,c=t.auth,u=((u||a)&&(this.context=this.Le.update(u,a)),r.context_check),a=this.context.Zt;u&&a!==f.default.j&&u!==a?this.ve(new _.default(I.Qt.INVALID_CALL,"the expected context_check had to be equal to: "+a+", got: "+u)):(this.fe(t),this.siteContext=this.context.Zt,this.pageContext=this.context.Se,this.groupContext=this.context.Oe,this.Ce=2===c,this.Te=3===c,this.De||(i=function(t){t.then(function(t){return s.Ge.Fe().then(function(t){return O.default.Je(t)})}).then(function(t){s.He(t)}).catch(function(t){O.default.Ve(null),s.We(t)})},e=function(t,n){t.then(function(t){O.default.Be()}).then(function(t){return s.Ge.Fe().then(function(t){return O.default.Je(t)})}).then(function(t){s.qe(!1)}).catch(function(t){O.default.Ve(n),s.We(t)})},this.Ce?(n=v.default.Ye.watch(f.default.K,function(t){O.default.state.ze(2),t?(O.default.Ve(t.id),i(s.xe.Ke(w.qt.NO_REGISTRATION,t.token))):(O.default.Ve(null),e(s.xe.Xe(),O.default.$e()))}))&&this.Qe.push(n):this.Te?(n=v.default.Ye.watch(f.default.$,function(t){O.default.state.ze(2),t?(O.default.Ve(t.id),i(s.xe.Ke(w.qt.EMAIL,t))):(O.default.Ve(null),e(s.xe.Xe(),O.default.$e()))}))&&this.Qe.push(n):this.Ze||(a=p.default.watch(d.default.Ut,function(t,n){t?(null==n?void 0:n.id)===t.id?(M.default(R.st,"onCredentialUpdated call"),s.He(t)):(M.default(R.st,"onCredentialStored call"),O.default.state.ze(2),O.default.Ve(t.id),i(s.xe.Ke(w.qt.SOCIAL,t))):(M.default(R.st,"onCredentialDeleted call"),O.default.state.ze(2),O.default.Ve(null),e(s.xe.Xe(),O.default.$e()))}))&&this.Qe.push(a)),f.default.D.our_origin=this.context.tn,f.default.L=r.local_persistence||!(null!=(u=null==r?void 0:r.custom_auth)&&u.enabled)||3!==o,this.browserPreferences=new L.default(this.context.Oe||this.context.Zt),this.xe.ts(),1!==o||this.De||M.default(R.it,"Verify "+this.siteContext+" for free in the Now4real Dashboard to get analytics, notifications, and more. Go to https://dashboard.now4real.com and follow the instructions."),this.ns=t)},x.prototype.es=function(t,n){M.default(R.st,"Auth info",t,n),O.default.Je(t),this.Me(t)},x.prototype.load=function(){var i=this;M.default(R.st,"Loading NOW4REAL",this.version),this.rs=!0,this.Pe=h.gi(),this.os(),this.us(this.cs),this.userPreferences=new F.default(this.Ge,function(){return i.hi},function(t){i.He(t)}),this.hs(),this.ls();this.fs(),v.default.ln=new D.default(D.default.Mi),this.Qe.push(function(t){v.default.ln.reset()}),this.Ze&&v.default.hn&&this.ds(),!this.De&&this.le.he()&&this.vs(),this.ws(),this.xe.ps().then(function(t){return Promise.all([i.Ge.Fe(),t])}).then(function(t){var n=t[0],t=t[1];i.je(i.Ne.get()),i.es(n,t),i.gs(t)}).then(function(t){i.pe()}).catch(function(t){t.code===I.Qt.RELOAD_REQUIRED?i.reload({updatedSiteConf:JSON.parse(t.message),reloadScriptConf:!1}):i.ve(t)})},x.prototype.ws=function(){this.Subject=I.ci,this.ErrorCode=I.Qt},x.prototype.gs=function(t){var n;0===O.default.state.bs&&(n=O.default.getUser(),t!==w.qt.READ_ONLY&&t!==w.qt.N4R&&(t!==w.qt.JWT&&t!==w.qt.NO_REGISTRATION&&t!==w.qt.EMAIL||n)?this.He(n):this.qe(!1))},x.prototype.Es=function(){window.n4rConfig||window.n4rTechnicalConfig?(t=window.n4rConfig,n=window.n4rTechnicalConfig,i=window.n4rConfig,s=e=null,this.De=!window.n4rNoAnalytics):(o=m.Ss(),t=(r=y.Os(o)).config,n=r.technicalConfig,i=r.scriptConfig,e=r.updatedConfig,s=o),f.default.T=t,f.default.N=s,f.default.D=n,f.default._=i;var t,n,i,e,s,r=t.logger,o=(r&&(f.default.S=A.O[r.Ni()]),f.default.ge=m.Ps(f.default.D.env_subdom),f.default.be=m.Cs(f.default.D.env_subdom),f.default.Ee=m.Ts(f.default.D.env_subdom),t.custom_auth);return this.Ze=null==o?void 0:o.enabled,v.default.hn="fn"===(null==o?void 0:o.jwt),M.default(R.st,"Extracted configuration",f.default.T,f.default.D,f.default._),e},x.prototype.Ns=function(t){var t=decodeURIComponent(t.substring(1)),n=y.Os(t),i=n.config,e=n.technicalConfig,n=n.scriptConfig,t=(f.default.T=i,f.default.N=t,f.default.D=e,f.default._=n,i.logger);t&&(f.default.S=A.O[t.Ni()]),M.default(R.st,"Updated configuration",f.default.T,f.default.D,f.default._)},x.prototype.Ds=function(){var t=this.De&&f.default.D.global_name?f.default.D.global_name:"now4real";this._e(t),window[t]=this},Object.defineProperty(x.prototype,"config",{get:function(){return f.default.T},_s:!1,ys:!0}),x.prototype.ce=function(){var l=this;this.le=new n.default({Is:function(){M.default(R.st,"onPageHiding call",document.visibilityState),C.default.publish(w.Bt.PageHiding,null)},Ms:function(){M.default(R.st,"onPageShowing call"),l.rs?C.default.publish(w.Bt.PageShowing,null):l.load()}}),this.Qe.push(function(){l.le.reset()}),t.default.init({As:function(n,i,t){M.default(R.st,"onProxyCommand call",n,i,t);function e(t){t.then(function(t){l.Rs(n,i,s,t)}).catch(function(t){l.Rs(n,i,r,t)})}var s="resolve",r="reject",o="subject";switch(i){case"startProxyLogin":e(l.Us());break;case"stopProxyLogin":l.xs();break;case"reload":l.reload(t[0]);break;case"subscribe":var u=t[0];l.subscribe(u,null,t[1],!0).then(function(t){t[o]=u,l.Rs(n,i,s,t)}).catch(function(t){t[o]=u,l.Rs(n,i,r,t)});break;case"unsubscribe":var a=t[0];l.unsubscribe(a,!0).then(function(t){t[o]=a,l.Rs(n,i,s,t)}).catch(function(t){t[o]=a,l.Rs(n,i,r,t)});break;case"post":e(l.post(t[0],t[1],!0));break;case"logout":case"deleteMessage":case"flushChat":case"setChatEnabled":case"getMute":case"setMute":case"startTyping":case"stopTyping":case"reportMessage":case"registerUserConsent":case"createPoll":case"closePoll":case"sendVote":case"getPollVote":case"getOlderMessages":case"setLoggerLevel":e(l[i].apply(l,t));break;case"browserPreferences.getItem":case"browserPreferences.setItem":case"browserPreferences.removeItem":var c=i.split("."),h=l[c[0]];e(h[c[1]].apply(h,t));break;default:M.default(R.it,"Unsupported message",n,i,t)}}},this.context.Ai,this.context.tn),this.Qe.push(function(){t.default.reset()})},x.prototype.We=function(t){var n;-1<t.message.indexOf("client")?n="DISCONNECTED:UNSUPPORTED_CLIENT":-1<t.message.indexOf("browser")?n="DISCONNECTED:UNSUPPORTED_BROWSER":t.code===I.Qt.CREDIT_EXHAUSTED&&(n="DISCONNECTED:CREDIT_EXHAUSTED"),n&&(this.ks(n),this.js())},x.prototype.os=function(){var n=this,t=s.default.li(),i=t.init(this.version,this.Ne,this.context.Zt,"demo"===f.default.T.target,this.De,this.Ze,this.Pe);t.Ls({Fs:function(t){n.ks(t),C.default.publish(w.Bt.ConnectionStatus,t)},Gs:function(){n.ks("DISCONNECTED:JWT_EXPIRED"),n.js(),n.Js(!1)},Hs:function(){n.ks("DISCONNECTED:CONFIG_CHANGED"),n.js(),n.Js(!1)},Vs:function(){n.ks("DISCONNECTED:CREDIT_EXHAUSTED"),n.js(),n.Js(!1)},Ws:function(){n.ks("DISCONNECTED:UNSUPPORTED_CLIENT"),n.js(),n.Js(!1)},Bs:function(){O.default.state.ze(2),O.default.Ve(null),t.Xe().then(function(t){O.default.Be()}).then(function(t){return n.Ge.Fe().then(function(t){return O.default.Je(t)})}).then(function(t){n.qe()})},qs:function(t){n.Ns(t)}}),this.xe=t,this.cs=i,this.Ys=i.connectionDetails},x.prototype.us=function(t){var n=this,i=e.default.li();i.init(t,function(){return n.Le.context}),this.Ge=i,O.default.Ge=i},x.prototype.hs=function(){var n=this,t=new k.default(C.default,this.le);t.init(function(){var t;n.xe.zs(),null!=(t=n.Ks)&&t.Xs()},function(){var t;0!==n.de&&(n.xe.$s(),null!=(t=n.Ks))&&t.Qs()}),v.default.dn=t},x.prototype.ls=function(){var t=this;this.Zs=new j.default(C.default,function(){t.tr(t.hi.find(I.ci.LIST_CHAT_MESSAGES)),M.default(R.st,"chat snapshot cleared")})},x.prototype.vs=function(){this.nr(this.hi.find(d.default.rt)),C.default.subscribe(w.Bt.PageHiding,this.ir.bind(this)),C.default.subscribe(w.Bt.PageShowing,this.er.bind(this))},x.prototype.sr=function(t,n){var i=this;m.rr(function(){i.ur(t,n||null)})},x.prototype.ur=function(t,n){var i,e=this.hi.find(t.type),n=n||e.Nn();if(M.default(R.st,"notifyEvent for subject: "+this.hi.find(t.type).name,t,n),-1<n.indexOf(1)&&(i=new a.qi({lsn:t.type,data:t}),this.notify(i,"p")),-1<n.indexOf(0)&&m.we(e.listener)){t.data&&delete t.data._snap;try{e.listener(t)}catch(t){M.default(R.nt,t.message)}}},x.prototype.notify=function(t,n){var i,e;!this.context||this.De&&"p"===n||(e=i=void 0,e="p"===n?(i=window.parent,void 0!==f.default.D.file_name?"*":this.context.Ai):(i=window,"*"),i.postMessage({cmd:t.cmd,payload:m.Tn(t.payload)},e))},x.prototype.ar=function(t){t=new P.re(t);this.sr(t,[0,1])},x.prototype.cr=function(t){t=new P.re(t);this.sr(t,[0,1])},x.prototype.ks=function(t){var n=this.hi.find(I.ci.CONNECTION_STATUS),i=n.snapshot.status;t!==i&&("DISCONNECTED"!==t||"DISCONNECTED:CREDIT_EXHAUSTED"!==i&&"DISCONNECTED:CONFIG_CHANGED"!==i&&"DISCONNECTED:UNSUPPORTED_CLIENT"!==i&&"DISCONNECTED:JWT_EXPIRED"!==i)&&(n.In(i={status:t},this),this.sr(new P.oe(i),[0,1]))},x.prototype.Ae=function(){this.hi.find(I.ci.AUTHORIZATION).In(N.default.state,this),this.ur(new P.se(N.default.state),[0,1])},x.prototype.hr=function(i){var t=this,n=this.lr.get(i);return void 0===n?(M.default(R.st,i+" not found in cache"),new Promise(function(n){t.lr.watch(i,function(t){M.default(R.st,"Resolved "+i,t),n(t)})})):Promise.resolve(n)},x.prototype.nr=function(e,t,n,s){var r,o,u,a=this,c=e.toString(),h=e.category,l=!1,i=new Promise(function(n,i){o=function(){var t="onSubscription call: "+c;l&&(t="re-".concat(t)),M.default(R.st,t),l?3!==h&&a.js(e):(n({}),s&&m.we(s.onAfterFirstSub)&&s.onAfterFirstSub(),l=!0)},u=function(t,n){l?M.default(R.nt,"Automatic "+c+" subscription recovery error",t,n):(delete a.dr[c],t===w.zt.Unauthorized?i(new _.default(I.Qt.NOT_AUTHORIZED,'not authorized to perform the "'+e.id+'" subscription')):i(new _.default(I.Qt.TECHNICAL_PROBLEM,t.toString())))}}),f={vr:o,wr:u,mr:function(t,n,i){M.default(R.it,c+" itemLostUpdates call",t,n,i),a.js(e),a.cs.unsubscribe(r),a.cs.subscribe(r)},pr:function(t,n){M.default(R.st,c+" onClearSnapshot call",t,n),a.js(e)}};if(n)for(var d in n)f[d]=n[d];switch(h){case 3:r=this.gr(e,f,t);break;case 6:r=this.br(e,f);break;case 1:r=this.Er(e,f);break;case 10:r=this.Sr(e,f);break;case 2:r=this.Or(e,f);break;case 4:r=this.Pr(e,f);break;case 5:r=this.Cr(e,f);break;case 9:r=this.Tr(e,f);break;case 7:r=this.Nr(e,f);break;case 8:r=this.Dr(e,f);break;case 12:r=this._r(e,f);break;case 11:r=this.yr(e,f)}return this.cs.subscribe(r),this.dr[c]=r,i},x.prototype._r=function(a,t){var c=this,n=a.prefix+":"+(f.default.T.scope===d.default.It?this.context.Ir||this.context.Mr:this.context.Ar),n=(M.default(R.st,"Computed item: "+n),new U.Subscription(a.mode,n,a.pn));return n.setRequestedSnapshot("yes"),n.addListener({onSubscription:t.vr,onSubscriptionError:t.wr,onItemUpdate:function(t){var i,t=m.Rr(t.getValue,t),n=t("b"),e=t("q"),s=t("o"),r=t("v"),o=t("t"),t=t("m"),u=(M.default(R.st,a.id+" update ("+c.Ys.getSessionId()+")",n,e,s,r,o,t),null),r=(e&&(s=s.split("\t"),i=m.Ur(r),u={closed:null===t,question:e,answers:s.map(function(t,n){return{text:t,percentage:i[n]}}),votesCount:o,multipleChoice:1<Number(t),startDate:m.kr(n)}),a.In(u,c),new P.te(u));c.sr(r)}}),n},x.prototype.yr=function(e,t){var s=this,n=e.prefix+":"+(f.default.T.scope===d.default.It?this.context.Ir||this.context.Mr:this.context.Ar),n=(M.default(R.st,"Computed item: "+n),new U.Subscription(e.mode,n,e.pn));return n.setRequestedSnapshot("yes"),n.addListener({onSubscription:t.vr,onSubscriptionError:t.wr,onItemUpdate:function(t){var t=m.Rr(t.getValue,t),n=t("q"),t=t("m"),i=(M.default(R.st,e.id+" update ("+s.Ys.getSessionId()+")",n,t),null),n=(e.In(i=n?{question:n,closed:null===t}:i,s),new P.Zi(i));s.sr(n)}}),n},x.prototype.Sr=function(n,t){var i=this,e=n.prefix+":"+d.default.Rt,e=(M.default(R.st,"Computed item: "+e),new U.Subscription(n.mode,e,n.pn));return e.addListener({onSubscription:t.vr,onSubscriptionError:t.wr,onItemUpdate:function(t){t=m.Rr(t.getValue,t)("t");M.default(R.st,n.prefix+" update ("+i.Ys.getSessionId()+")",t),"e"===t&&G.timeout(f.default.B,v.default.ln.send(new c.Li)).then(function(t){M.default(R.st,"obtained new JWT",t);try{i.xe.jr(t),i.Ge.Lr(t)}catch(t){throw t}}).catch(function(t){M.default(R.nt,t.message)})}}),e.setRequestedSnapshot("no"),e.setDataAdapter("EVENT"),e},x.prototype.Dr=function(t,n){var e=this,s=t.toString(),i=t.prefix+":"+(f.default.T.scope===d.default.It?this.context.Ir||this.context.Mr:this.context.Ar),i=(M.default(R.st,"Computed item: "+i),new U.Subscription(t.mode,i,t.pn));return i.setRequestedSnapshot(d.default._t),i.addListener({onSubscription:n.vr,onSubscriptionError:n.wr,onItemUpdate:function(t){var n,t=m.Rr(t.getValue,t),i=(M.default(R.st,s+" update ("+e.Ys.getSessionId()+")",t(d.default.lt),t("d")),(n={})[d.default.ft]=d.default.UPDATE,n[d.default.lt]=t(d.default.lt),n.d=t("d"),n.p=null,n.i=null,n.u=null,n.s=null,n.r=null,n.isSnapshot=function(){return!1},n.getValue=function(t){return void 0!==i[t]?i[t]:null},n);e.Ks.Fr(i).then(function(t){var n;t&&(M.default(R.st,"CHAT evt upds",t),(n=e.hi.find(I.ci.LIST_CHAT_MESSAGES)).In(e.Ks.get(),e),t.forEach(function(t){t._snap=n.snapshot;t=new P.ee(t);e.sr(t)}))}).catch(function(t){M.default(R.st,t)})}}),i},x.prototype.Nr=function(c,t){var h=this,n=c.prefix+":"+(f.default.T.scope===d.default.It?this.context.Ir||this.context.Mr:this.context.Ar),n=(M.default(R.st,"Computed item: "+n),new U.Subscription(c.mode,n,c.pn));return n.setRequestedSnapshot(d.default.Dt),n.addListener({onSubscription:t.vr,onSubscriptionError:t.wr,onItemUpdate:function(t){var n,i,e,s,r,o,u,a=m.Rr(t.getValue,t),t=(M.default(R.st,c.prefix+" update ("+h.Ys.getSessionId()+", "+t.isSnapshot()+")",a(d.default.ft)+"-"+a(d.default.lt)+"-"+a("n")+"-"+a("i")+"-"+a("p")+"-"+a("r")+"-"+a("b")+"-"+a("bf")+"-"+a("bb")),a(d.default.ft));t!==d.default.dt&&t!==d.default.UPDATE||(t=a(d.default.lt),n=a("n"),i=a("i"),e=a("p"),s=a("r"),o=a("b"),u=a("bf"),a=a("bb"),r=null,s&&(r=m.Gr(s,o,u,a)),u=m.Jr(o={id:t,nick:n,icon:i,provider:e},r?r.role:null,r?r.badge:null),h.lr.set(u),(a=h.hi.find(I.ci.LOGIN_STATUS).snapshot.user)&&a.id===u.id&&(h.Ce||h.Te||p.default.Hr(n,i),O.default.Vr(s?r.role:null,s?r.badge:null),h.He(o)))}}),n},x.prototype.Er=function(t,n){var i=f.default.T.scope===d.default.It&&t.name===d.default.ot?d.default.Ft+"/":""+d.default.Gt+this.context.Se,i=t.prefix+":"+i,i=(M.default(R.st,"Computed item: "+i),new U.Subscription(t.mode,i,t.pn));return i.addListener({onSubscription:n.vr,onSubscriptionError:n.wr}),i},x.prototype.gr=function(i,t,n){var e=this,s=i.toString(),r=i.prefix+":"+(f.default.T.scope===d.default.It?this.context.Ir||this.context.Mr:this.context.Ar),r=(M.default(R.st,"Computed item: "+r),new U.Subscription(i.mode,r,i.pn));return r.setRequestedSnapshot(!n||n.snapshot?d.default.Dt:d.default._t),r.addListener({onSubscription:t.vr,onSubscriptionError:t.wr,onItemLostUpdates:t.mr,onClearSnapshot:t.pr,onEndOfSnapshot:function(){e.Ks.Wr().then(function(t){t&&(M.default(R.st,"CHAT snapshot upds",t),i.In(e.Ks.get(),e),t.forEach(function(t){t._snap=i.snapshot;t=new P.ee(t);e.sr(t)}))}).catch(function(t){M.default(R.st,t)})},onItemUpdate:function(t){var n=m.Rr(t.getValue,t);M.default(R.st,s+" update ("+e.Ys.getSessionId()+", "+t.isSnapshot()+")",n(d.default.lt),n("u"),n("i"),n("p"),n("r"),n("s"),n("d")),e.Ks.Fr(t).then(function(t){t&&(M.default(R.st,"CHAT upds",t),i.In(e.Ks.get(),e),t.forEach(function(t){t._snap=i.snapshot;t=new P.ee(t);e.sr(t)}))}).catch(function(t){M.default(R.st,t)})}}),r},x.prototype.Tr=function(h,t){var l=this,n=f.default.T.scope===d.default.It?d.default.Ft+"/":""+d.default.Gt+this.context.Se,n=h.prefix+":"+n,n=(M.default(R.st,"Computed item: "+n),new U.Subscription(h.mode,n,h.pn));return n.setRequestedSnapshot(d.default.Dt),n.addListener({onSubscription:t.vr,onSubscriptionError:t.wr,onItemLostUpdates:t.mr,onItemUpdate:function(t){var n=m.Rr(t.getValue,t),i=n("ml"),e=n("mlm"),s=n("md"),r=n("cd"),o=n("mh"),u=n("gr"),n=n("mv");if(M.default(R.st,h.toString()+" update ("+l.Ys.getSessionId()+", "+t.isSnapshot()+")",i,e,s,r,o,u,n),null!==i&&null!==e&&null!==s&&null!==r){var t=Number(i),i=Number(e),e=m.Br(s),a=void 0;switch(r){case"M":a="DISABLED_BY_MODERATOR";break;case"A":a="DISABLED_BY_ADMINISTRATOR";break;default:a="ENABLED"}var c=void 0;switch(u){case"1":c="G";break;case"2":c="PG";break;case"3":c="PG-13";break;case"4":c="R";break;default:c="DISABLED"}NaN!==t&&NaN!==i&&(s={messageMaxLength:t,messageMaxLengthModerator:i,messageMaxLengthGuest:i,messageDurationValue:e.value,messageDurationUnit:e.unit,chatStatus:a,clickableLinks:"a"===o?"ALL":"INTERNALS",gifsStatus:c},h.In(s,l),r=new P.ie(s),l.sr(r,[0,1]),l.Ks)&&(u=m.qr(e.value,e.unit),l.Ks.Yr(1e3*u),l.Ks.zr(m.kr(n)))}n&&(v.default.vn=m.kr(n))}}),n},x.prototype.Or=function(i,t){var n,e=this,s=i.prefix,r=i.name,o=i.context,u=i.toString();switch(o){case 0:n=r!==I.ci.COUNTER_CHAT_TYPING&&r!==I.ci.COUNTER_CHAT_MESSAGES||f.default.T.scope!==d.default.It?s+":"+this.context.Ar:s+":"+(this.context.Ir||this.context.Mr);break;case 1:n=s+":"+(this.context.Oe||this.context.Zt);break;case 2:n=s+":"+d.default.Rt;break;case 3:n=s+":"+(this.context.Zt+i.En)}M.default(R.st,"Computed item: "+n);o=new U.Subscription(i.mode,n,i.pn);return o.setRequestedSnapshot(d.default.Dt),o.addListener({onSubscription:t.vr,onSubscriptionError:t.wr,onItemLostUpdates:t.mr,onItemUpdate:function(t){var n=(n=m.Rr(t.getValue,t)(i.pn[0]))&&n.toString();M.default(R.st,u+" update ("+e.Ys.getSessionId()+", "+t.isSnapshot()+")",n),n!==i.snapshot.value?(i.In(t={value:n},e),n=new P.Qi(r,t),e.sr(n)):M.default(R.st,"Discarded counter update",i)}}),o},x.prototype.Pr=function(r,t){var o=this,u=r.toString(),a=r.name,n=r.prefix+":"+(2===r.context?d.default.Rt:this.context.Oe||this.context.Zt),i=(M.default(R.st,"Computed item: "+n),!1),e=m.Tn(r.pn),e=this.De?e.concat(["f"]):e,n=new U.Subscription(r.mode,n,e);return n.setRequestedSnapshot(d.default.Dt),n.addListener({onSubscription:t.vr,onSubscriptionError:t.wr,onItemLostUpdates:t.mr,onClearSnapshot:t.pr,onEndOfSnapshot:function(){var t;M.default(R.st,u+" endOfSnapshot call"),i||(i=!0,t=new P.$i(a,o.Xr.Kr()),o.sr(t))},onItemUpdate:function(t){var n=m.Rr(t.getValue,t),n=(M.default(R.st,u+" update ("+o.Ys.getSessionId()+", "+t.isSnapshot()+")",n(d.default.lt),n(d.default.ft),n("i"),n("t"),n("c"),n("p")),o.Xr.Fr(r,t));if(n){r.In(o.Xr.get(u,!0),o);for(var i=0,e=n;i<e.length;i++){var s=e[i],s=(s._snap=r.snapshot,new P.$i(a,s));o.sr(s)}}else M.default(R.st,"Discarded "+u+" ranking update")}}),n},x.prototype.br=function(i,t){var e=this,s=i.toString(),n=i.prefix+":"+(f.default.T.scope===d.default.It?this.context.Ir||this.context.Mr:this.context.Ar),n=(M.default(R.st,"Computed item: "+n),new U.Subscription(i.mode,n,i.pn));return n.setRequestedSnapshot(d.default.Dt),n.addListener({onSubscription:t.vr,onSubscriptionError:t.wr,onItemLostUpdates:t.mr,onClearSnapshot:t.pr,onItemUpdate:function(t){var n=m.Rr(t.getValue,t);M.default(R.st,s+" update ("+e.Ys.getSessionId()+", "+t.isSnapshot()+")",n(d.default.lt),n(d.default.ft)),e.$r.Fr(t).then(function(t){i.In(e.$r.get(),e),t._snap=i.snapshot;t=new P.ne(t);e.sr(t)}).catch(function(t){M.default(R.st,t)})}}),n},x.prototype.Cr=function(r,t){var n,o=this,u=r.id,i=r.prefix,a=r.name;switch(r.context){case 0:n=i+":"+this.context.Ar;break;case 1:n=i+":"+(this.context.Oe||this.context.Zt);break;default:M.default(R.nt,"H sub unsupported context")}M.default(R.st,"Computed item: "+n);var e=new U.Subscription(r.mode,n,r.pn);return e.setRequestedSnapshot(d.default.Dt),e.addListener({onSubscription:t.vr,onSubscriptionError:t.wr,onItemLostUpdates:t.mr,onItemUpdate:function(t){var n=m.Rr(t.getValue,t),n=(M.default(R.st,u+" update ("+o.Ys.getSessionId()+", "+t.isSnapshot()+")",n("c"),n("h")),o.Qr.Fr(u,t));if(n){r.In(o.Qr.get(u),o);for(var i=0,e=n;i<e.length;i++){var s=e[i],s=(s._snap=r.snapshot,new P.Xi(a,s));o.sr(s)}}else M.default(R.st,"Discarded "+u+" update")}}),e},x.prototype.er=function(){var t=this.hi.find(d.default.rt).id,n=this.dr[t];n?(this.cs.subscribe(n),M.default(R.st,"Subscribe "+t)):M.default(R.it,"Undefined "+t)},x.prototype.ir=function(){var t=this.hi.find(d.default.rt).id,n=this.dr[t];n?(this.cs.unsubscribe(n),M.default(R.st,"Unsubscribe "+t)):M.default(R.it,"Undefined "+t)},x.prototype.Zr=function(){var t=this.hi.find(d.default.ot);return M.default(R.st,"Subscribe "+t.id),this.nr(t)},x.prototype.no=function(){var t=this.hi.find(d.default.ot).id;this.io(t),M.default(R.st,"Unsubscribe "+t)},x.prototype.fs=function(){var t=this.hi.find(I.ci.PARAMETERS);this.nr(t),M.default(R.st,"Subscribe "+t.id)},x.prototype.ds=function(){var t=this.hi.find(d.default.ht);this.nr(t),M.default(R.st,"Subscribe "+t.id)},x.prototype.Rs=function(t,n,i,e){t=new a.Bi({id:t,fn:n,res:i,data:e});this.notify(t,"p")},x.prototype.eo=function(){this.lr||(this.lr=new i.default,this.nr(this.hi.find(d.default.ut)))},x.prototype.so=function(){var t=this.hi.find(d.default.ct);this.dr[t.id]||this.nr(t)},x.prototype.io=function(t){this.dr[t]?(this.dr[t].isActive()?this.cs.unsubscribe(this.dr[t]):M.default(R.st,"Already unsubscribed",t),delete this.dr[t]):M.default(R.it,"Subscription flow sync error",t,this.dr)},x.prototype.ro=function(e,t,n,i){var s,r,o=this,u=null,a=e.category,c=e.toString(),h=e.Ln()?void 0===e.listener:void 0===this.dr[c];switch(e.Dn(i.oo?1:0),a){case 3:this.eo(),this.Ks||(this.Ks=S.default.li()),h&&(M.default(R.st,"Initilize subject: "+e),this.so(),r=(s=this.hi.find(I.ci.PARAMETERS)).snapshot.messageDurationValue,s=s.snapshot.messageDurationUnit,r=m.qr(r,s),this.Ks.init(this.hr.bind(this),this.Ge.uo.bind(this.Ge),this.lr,1e3*r,v.default.vn||null,function(t){t&&0<t.length&&(M.default(R.st,"CHAT del upds",t),e.In(o.Ks.get(),o),t.forEach(function(t){t._snap=e.snapshot;t=new P.ee(t);o.sr(t)}))}),this.ao||(this.ao=this.lr.watch(w.Bt.UserUpdated,function(t){t=o.Ks.Hr(t);if(t.length){M.default(R.st,"chat list user updates",t),e.In(o.Ks.get(),o);for(var n=t.map(function(t){return l(l({},t),{_snap:e.snapshot})}),i=0;i<n.length;i++)o.sr(new P.ee(n[i]))}})),this.Zs.ho(),u=this.nr(e,n,null));break;case 6:this.eo(),this.$r||(this.$r=E.default.li()),h&&(M.default(R.st,"Initilize subject: "+e),this.$r.init(this.hr.bind(this)),u=this.nr(e,null,null));break;case 2:case 12:case 11:h&&(M.default(R.st,"Initilize subject: "+e),u=this.nr(e,null,null));break;case 4:void 0===this.Xr&&(this.Xr=b.default.li()),h&&(M.default(R.st,"Initilize subject: "+e),this.Xr.init(c,this.Le,this.De),u=this.nr(e,null,null));break;case 5:void 0===this.Qr&&(this.Qr=g.default.li()),h&&(M.default(R.st,"Initilize subject: "+e),this.Qr.init(c),u=this.nr(e,null,null))}return h&&!e.Ln()&&e.yn(this),i.oo&&(i.oo,m.we(e.listener))||e.Un(t),null!==u?u:new Promise(function(t){t({}),m.rr(function(){o.lo(e,i.oo)})})},x.prototype.fo=function(t,n){var i=t.toString(),e=t.Nn().length,n=n.oo?1:0;return 1===e?(t._n(n),t.Ln()||(this.io(i),t.An(this)),t.Gn()?this.hi.di(t):t.xn(),t.name===I.ci.LIST_CHAT_MESSAGES?(this.Zs.do(),this.ao&&(this.lr.unwatch(w.Bt.UserUpdated,this.ao),this.ao=null),this.Ks.vo()):t.name===I.ci.LIST_CHAT_TYPING&&this.$r.vo(),new Promise(function(t){t({})})):(t._n(n),0==n&&t.xn(),Promise.resolve({}))},x.prototype.js=function(t){if(t)this.tr(t);else for(var n in M.default(R.st,"Reset snapshot"),this.dr)this.tr(this.hi.wi(n))},x.prototype.lo=function(n,t){M.default(R.st,"notifySnapshot",n,t);var i=n.category,e=n.name,s=n.id,r=[t?1:0];if(n.Ln())this.sr(new P.ue(n.name,n.snapshot),r);else switch(i){case 3:var o=this.Ks.snapshot().map(function(t){return l(l({},t),{_snap:n.snapshot})});if(0<o.length)for(var u=0;u<o.length;u++)this.sr(new P.ee(o[u]),r);break;case 4:var a=this.Xr.snapshot(s);if(a.push(this.Xr.Kr()),a.map(function(t){return l(l({},t),{_snap:n.snapshot})}),0<a.length)for(u=0;u<a.length;u++)this.sr(new P.$i(e,a[u]),r);break;case 5:var c=this.Qr.snapshot(s).map(function(t){return l(l({},t),{_snap:n.snapshot})});if(0<c.length)for(u=0;u<c.length;u++)this.sr(new P.Xi(e,c[u]),r);break;case 6:var h=this.$r.snapshot().map(function(t){return l(l({},t),{_snap:n.snapshot})});if(0<h.length)for(u=0;u<h.length;u++)this.sr(new P.ne(h[u]),r);break;case 2:null!==n.snapshot.value&&this.sr(new P.Qi(e,n.snapshot),r)}},x.prototype.tr=function(e){var s=this,t=e.category,n=e.name,r=e.toString();switch(t){case 3:this.Ks.wo().then(function(t){var n=t.map(function(t){return l(l({},t),{_snap:e.Cn})});if(0<n.length){for(var i=0;i<n.length;i++)s.sr(new P.ee(n[i]));e.In(s.Ks.get(),s),M.default(R.st,"Reset "+r+" subscription")}});break;case 4:var i=this.Xr.wo(r).map(function(t){return l(l({},t),{_snap:e.Cn})});if(0<i.length){for(var o=0;o<i.length;o++)this.sr(new P.$i(n,i[o]));e.Rn(this),M.default(R.st,"Reset "+r+" subscription")}break;case 5:var u=this.Qr.wo(r).map(function(t){return l(l({},t),{_snap:e.Cn})});if(0<u.length){for(o=0;o<u.length;o++)this.sr(new P.Xi(n,u[o]));e.Rn(this),M.default(R.st,"Reset "+r+" subscription")}break;case 6:this.$r.wo().then(function(t){var n=t.map(function(t){return l(l({},t),{_snap:e.Cn})});if(0<n.length){for(var i=0;i<n.length;i++)s.sr(new P.ne(n[i]));e.Rn(s),M.default(R.st,"Reset "+r+" subscription")}});break;case 2:null!==e.snapshot.value&&(this.sr(new P.Qi(n,e.Cn)),e.Rn(this),M.default(R.st,"Reset "+r+" subscription"))}},x.prototype.qe=function(t){M.default(R.st,"handleLogout call",t=void 0===t?!0:t),4!==O.default.state.bs&&(O.default.state.ze(4),t&&(this.Ce||this.Te?((t=v.default.Ye).removeItem(this.Ce?f.default.K:f.default.$),t.removeItem(this.Ce?f.default.X:f.default.Z)):p.default.mo()),t={status:"NOT_AUTHENTICATED"},this.hi.find(I.ci.LOGIN_STATUS).In(t,this),this.cr(t),C.default.publish(w.Bt.Authentication,{authorization:O.default.po()}))},x.prototype.He=function(t){M.default(R.st,"handleLogin call",t),3!==O.default.state.bs&&O.default.state.ze(3);var n=this.hi.find(I.ci.LOGIN_STATUS),i=n.snapshot,e=!this.Ze||(null==(e=O.default.getUser())?void 0:e.consent),s=!this.Ze&&(this.Ce?v.default.Ye.bo():!p.default.Eo()),r=O.default.getDetails(),e={status:"AUTHENTICATED",user:m.So(t,e,r?r.role:null,r?r.badge:null,r?r.preferences:null),persistent:s};m.Oo(i,e)||(n.In(e,this),this.ar(e),C.default.publish(w.Bt.Authentication,{user:t,authorization:O.default.po()}))},x.prototype.Js=function(t){var n;for(void 0===t&&(t=!0);this.Qe.length;)null!=(n=this.Qe.shift())&&n();t&&this.me()},x.prototype._load=function(i){var r,o=this;return M.default(R.et,"_load call",arguments),(i=i||location.href)&&m.Po(i)?(r=function(t){return t.startsWith(d.default.wt)?t:d.default.wt+"://"+t},new Promise(function(e,n){var s=o.Le.Co(r(i));(t=>(o.Ne=new T.default(t,o.Le.To()),("now4real.com"===(t=t)?Promise.resolve('{"s":3,"v":3}'):o.Ne.fetch(t).then(function(t){return t.responseText})).then(function(t){return o.Ne.update(t).status})))(s).then(function(t){0!==t?(t=i,document.customReferrer=r(t),o.context=o.Le.update(null,null),C.default.subscribe(w.Bt.Load,function(t){var n=o.ns,i=n.master;e({siteContext:s,master:i,group:n.group})}),C.default.subscribe(w.Bt.LoadError,function(t){n(t)}),o.start()):(t=new _.default(I.Qt.CURRENTLY_DISABLED,"the site is currently disabled"),o.ve(t),n(t))}).catch(function(t){t=403===t.statusCode?new _.default(I.Qt.INVALID_CALL,"the site is not registered yet"):new _.default(I.Qt.TECHNICAL_PROBLEM,t.statusCode);o.ve(t),n(t)})})):Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,""))},x.prototype.setLoggerLevel=function(t){if(M.default(R.et,"setLoggerLevel call",arguments),!t)return Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"invalid level argument"));if(!m.Po(t))return Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"level must be a string"));t=t.toLowerCase().Ni();if(void 0===A.O[t])return Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"invalid level name"));f.default.S=A.O[t];t=new a.Wi({level:A.O[t]});return this.notify(t,"p"),this.notify(t,"s"),Promise.resolve({})},x.prototype.subscribe=function(t,n,i,e){var s;return void 0===e&&(e=!1),M.default(R.et,"subscribe call",arguments),m.Po(t)?(s=this.hi.find(t))?!s.Fn()&&s.name===t||3===this.de?12!==s.category&&11!==s.category||3===this.de?s.name!==t?Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"not customizable subject")):e||m.we(n)?!e&&-1<s.Nn().indexOf(0)?Promise.reject(new _.default(I.Qt.INVALID_CALL,"already subscribed subject")):this.ro(s,n,i,{oo:e}):Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"callback must be a function")):Promise.reject(new _.default(I.Qt.INVALID_CALL,"poll is a Premium feature")):(s.Fn()&&this.hi.di(s),Promise.reject(new _.default(I.Qt.INVALID_CALL,"custom context is a Premium feature"))):Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"subject not exists")):Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"subject must be a string"))},x.prototype.unsubscribe=function(t,n){return void 0===n&&(n=!1),M.default(R.et,"unsubscribe call",arguments),m.Po(t)?(t=this.hi.find(t))?!t.Ln()&&!t.jn()||t.Ln()&&void 0===t.listener?Promise.reject(new _.default(I.Qt.INVALID_CALL,"not subscribed subject")):this.fo(t,{oo:n}):Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"subject not exists")):Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"subject must be a string"))},x.prototype.get=function(t){M.default(R.et,"get call",arguments);var n=this.hi.find(t);if(!n||n.name!==t)throw new _.default(I.Qt.INVALID_ARGUMENTS,"invalid subject");if(n.jn())return n.snapshot;throw new _.default(I.Qt.INVALID_CALL,"not subscribed subject")},x.prototype.editUserProfile=function(){var t,n,i,e;return M.default(R.et,"editUserProfile call",arguments),this.Ze?Promise.reject(new _.default(I.Qt.INVALID_CALL,"not supported using custom auth")):(t=this.hi.find(I.ci.LOGIN_STATUS).snapshot.user)?(n=this.Le.context.Zt,i=this._whiteLabel,e=null==(e=this.Ne.get())?void 0:e.siteKey,O.default.editUserProfile(n,e,t.id,i)):Promise.reject(new _.default(I.Qt.NOT_AUTHENTICATED,"the user is not authenticated"))},x.prototype.login=function(t){M.default(R.et,"login call",arguments);var n,i,e,s,r=this.hi.find(I.ci.CONNECTION_STATUS).snapshot.status;return/^DISCONNECTED:/.test(r)?Promise.reject(new _.default(I.Qt.INVALID_CALL,"the client is on an unrecoverable disconnection status")):this.Pe?Promise.reject(new _.default(I.Qt.INVALID_CALL,"not supported on this browser")):this.Ze?Promise.reject(new _.default(I.Qt.INVALID_CALL,"not supported using custom auth")):3===O.default.state.bs?Promise.reject(new _.default(I.Qt.INVALID_CALL,"the user is already authenticated")):(r=this.Ce,n=this.Te,i=this._whiteLabel,r||n||!t||m.Po(t)?r||n||!t||void 0!==w.Xt[t]||t===d.default.EMAIL?void 0!==O.default.window?(O.default.window.focus(),Promise.reject(new _.default(I.Qt.ALREADY_STARTED,"already opened authentication window"))):(e=this.Le.context.Zt,s=null==(s=this.Ne.get())?void 0:s.siteKey,this.No(r?O.default.Do(e,s,i):O.default._o(e,t,s,n,i),n,r)):Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"invalid provider name")):Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"provider must be a string")))},x.prototype.Us=function(){M.default(R.st,"startProxyLogin");var t=this.Ce,n=this.Te;return this.No(O.default.yo(t),n,t)},x.prototype.xs=function(){M.default(R.st,"stopProxyLogin"),O.default.Io()},x.prototype.No=function(t,i,e){var n=this;return t.then(function(t){return i||e?v.default.Ye.setItem(i?f.default.$:f.default.K,t):p.default.Mo(t),O.default.Ve(t.id),t}).then(function(t){return n.xe.Ke(e?w.qt.NO_REGISTRATION:i?w.qt.EMAIL:w.qt.SOCIAL,e?t.token:t)}).then(function(t){return O.default.reset(),n.Ge.Fe().then(function(t){return O.default.Je(t)})}).then(function(t){return n.He(t),t}).then(function(t){var n=O.default.getDetails();return{user:m.So(t,!0,n?n.role:null,n?n.badge:null,n?n.preferences:null),persistent:e||i?v.default.Ye.bo():!p.default.Eo()}}).catch(function(t){throw O.default.reset(),O.default.Ve(null),n.We(t),t})},x.prototype.logout=function(){var e,s=this,t=(M.default(R.et,"logout call",arguments),this.hi.find(I.ci.CONNECTION_STATUS).snapshot.status);return/^DISCONNECTED:/.test(t)?Promise.reject(new _.default(I.Qt.INVALID_CALL,"the client is on an unrecoverable disconnection status")):this.Ze?Promise.reject(new _.default(I.Qt.INVALID_CALL,"not supported using custom auth")):3!==O.default.state.bs?Promise.reject(new _.default(I.Qt.INVALID_CALL,"already in readOnly state")):(e=O.default.$e(),new Promise(function(n,i){var t;O.default.state.ze(2),O.default.Ve(null),(s.Ce?Promise.resolve():(t=s.Te?v.default.Ye.getItem(f.default.$).secret:p.default.Ro().Ao,s.Ge.Uo(t))).then(function(t){return s.xe.Xe()}).then(function(t){O.default.Be()}).then(function(t){return s.Ge.Fe().then(function(t){return O.default.Je(t)})}).then(function(t){s.qe(!0),n({})}).catch(function(t){s.We(t),O.default.Ve(e),i(t)})}))},x.prototype.post=function(t,n,r){var i,e,o=this;return void 0===r&&(r=!1),M.default(R.et,"post call",arguments),m.Po(t)?""===t?Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"message can't be empty")):(e=this.hi.find(I.ci.PARAMETERS),i=(i=O.default.getDetails())?i.role:null,e=m.xo(e,i),M.default(R.st,"using pars: "+e+", "+this.ko),m.jo(t)>e?Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"message too long")):"DISCONNECTED"===this.hi.find(I.ci.CONNECTION_STATUS).snapshot.status?Promise.reject(new _.default(I.Qt.DISCONNECTED,"the client is disconnected from the server")):this.hi.find(I.ci.LOGIN_STATUS).snapshot.user?null!==this.ko?Promise.reject(new _.default(I.Qt.TOO_FREQUENT,"posting rate exceeded, please wait for the required interval")):!this.Ze||O.default.getUser().consent||this._whiteLabel?new Promise(function(s,i){o.Ge.Lo(t,n).then(function(t){var n=t.w||0,t=t.s,i=1e3*n,e={waitPeriod:i};t&&(e.suggestions=t),0!==n&&(o.ko=window.setTimeout(function(t){o.ko=null,M.default(R.st,"Posting re-enabled")},i)),"api+widget"===f.default.T.target&&(o._suggestions=n=t||null,r)&&(i=new a.Hi({suggestions:n}),o.notify(i,"s")),s(e)}).catch(function(t){var n=t;t instanceof _.default||(n="MUTED"===t?new _.default(I.Qt.USER_MUTED,"the user is muted"):"SEND_RATE"===t?new _.default(I.Qt.TOO_FREQUENT,"the message was posted before resendTimeout has expired"):"MODERATION"===t?new _.default(I.Qt.CANNOT_MODERATE,"the automatic content filtering system doesn't respond"):"CHAT_DISABLED"===t?new _.default(I.Qt.CHAT_DISABLED,"the chat is currently disabled"):"FILTERED"===t?new _.default(I.Qt.BLOCKED,"the message was blocked by an automatic moderation filter as it was deemed inappropriate"):"CHATBOT"===t?new _.default(I.Qt.CHATBOT,"an error occurred with the site's chatbot. Please try again"):new _.default(I.Qt.TECHNICAL_PROBLEM,"")),i(n)})}):Promise.reject(new _.default(I.Qt.INVALID_CALL,"the consent of the current user has not been recorded")):Promise.reject(new _.default(I.Qt.NOT_AUTHENTICATED,"the user is not authenticated"))):Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"message must be a string"))},x.prototype.deleteMessage=function(t){return t?m.Po(t)?this.hi.find(I.ci.LOGIN_STATUS).snapshot.user?"DISCONNECTED"===this.hi.find(I.ci.CONNECTION_STATUS).snapshot.status?Promise.reject(new _.default(I.Qt.DISCONNECTED,"the client is disconnected from the server")):this.Ge.Fo(t):Promise.reject(new _.default(I.Qt.NOT_AUTHENTICATED,"the user is not authenticated")):Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"msgId must be a string")):Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"msgId is required"))},x.prototype.flushChat=function(){var t;return this.hi.find(I.ci.LOGIN_STATUS).snapshot.user?(t=O.default.getDetails())&&t.role===d.default.jt?"DISCONNECTED"===this.hi.find(I.ci.CONNECTION_STATUS).snapshot.status?Promise.reject(new _.default(I.Qt.DISCONNECTED,"the client is disconnected from the server")):this.Ge.Go().then(function(t){return{}}):Promise.reject(new _.default(I.Qt.INVALID_CALL,"the user is not a MODERATOR")):Promise.reject(new _.default(I.Qt.NOT_AUTHENTICATED,"the user is not authenticated"))},x.prototype.setChatEnabled=function(t){var n;return void 0!==t&&m.Jo(t)?this.hi.find(I.ci.LOGIN_STATUS).snapshot.user?(n=O.default.getDetails())&&n.role===d.default.jt?"DISCONNECTED"===this.hi.find(I.ci.CONNECTION_STATUS).snapshot.status?Promise.reject(new _.default(I.Qt.DISCONNECTED,"the client is disconnected from the server")):this.Ge.Ho(t).then(function(t){return{}}):Promise.reject(new _.default(I.Qt.INVALID_CALL,"the user is not a MODERATOR")):Promise.reject(new _.default(I.Qt.NOT_AUTHENTICATED,"the user is not authenticated")):Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"invalid enabled argument"))},x.prototype.getMute=function(t){return M.default(R.et,"getMute call",arguments),void 0!==t&&m.Po(t)?this.hi.find(I.ci.LOGIN_STATUS).snapshot.user?"DISCONNECTED"===this.hi.find(I.ci.CONNECTION_STATUS).snapshot.status?Promise.reject(new _.default(I.Qt.DISCONNECTED,"the client is disconnected from the server")):this.Ge.Vo(t).then(function(t){return t?{expiration:(t=t.expiration)?new Date(t).getTime():null}:null}):Promise.reject(new _.default(I.Qt.NOT_AUTHENTICATED,"the user is not authenticated")):Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"invalid userId argument"))},x.prototype.setMute=function(t,n){var i;return M.default(R.et,"setMute call",arguments),void 0!==t&&m.Po(t)?void 0===n||null!==n&&!m.Wo(n)?Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"invalid duration argument")):this.hi.find(I.ci.LOGIN_STATUS).snapshot.user?(i=O.default.getDetails())&&i.role===d.default.jt?"DISCONNECTED"===this.hi.find(I.ci.CONNECTION_STATUS).snapshot.status?Promise.reject(new _.default(I.Qt.DISCONNECTED,"the client is disconnected from the server")):this.Ge.Bo(t,n).then(function(t){return t?{expiration:(t=t.expiration)?new Date(t).getTime():null}:null}):Promise.reject(new _.default(I.Qt.INVALID_CALL,"the user is not a MODERATOR")):Promise.reject(new _.default(I.Qt.NOT_AUTHENTICATED,"the user is not authenticated")):Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"invalid userId argument"))},x.prototype.startTyping=function(){var i=this;return M.default(R.et,"startTyping call",arguments),this.dr[this.hi.find(d.default.ot).toString()]?Promise.reject(new _.default(I.Qt.INVALID_CALL,"the user has already started to type")):new Promise(function(t,n){i.Zr().then(function(){t({})}).catch(function(t){n(t)})})},x.prototype.stopTyping=function(){return M.default(R.et,"stopTyping call",arguments),this.dr[this.hi.find(d.default.ot).toString()]?(this.no(),Promise.resolve({})):Promise.reject(new _.default(I.Qt.INVALID_CALL,"the user has already stopped to type"))},x.prototype.reload=function(t){if(this.De)throw new Error("Unsupported feature");var n=null!=(n=null==t?void 0:t.startOpen)&&n,i=null!=(i=null==t?void 0:t.updatedSiteConf)?i:null,t=null==(t=null==t?void 0:t.reloadScriptConf)||t;this.notify(new c.Fi(n,i,t),"p")},x.prototype.reportMessage=function(t,n,i){M.default(R.et,"reportMessage call",arguments);var e="invalid msgId argument",s="invalid reason argument";return void 0!==t&&m.Po(t)?void 0!==n&&m.Po(n)?i&&!m.Po(i)?Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"invalid comment argument")):i&&500<i.length?Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"comment too long")):this.hi.find(I.ci.LOGIN_STATUS).snapshot.user?"DISCONNECTED"===this.hi.find(I.ci.CONNECTION_STATUS).snapshot.status?Promise.reject(new _.default(I.Qt.DISCONNECTED,"the client is disconnected from the server")):this.Ge.qo(t,n,i).catch(function(t){var n=t;throw n=t instanceof _.default?n:"INVALID_MESSAGE_ID"===t?new _.default(I.Qt.INVALID_ARGUMENTS,e):"INVALID_REASON"===t?new _.default(I.Qt.INVALID_ARGUMENTS,s):"DUPLICATED"===t?new _.default(I.Qt.ALREADY_REPORTED,"the user has already reported the msg"):"MUTED"===t?new _.default(I.Qt.USER_MUTED,"the user is muted"):new _.default(I.Qt.TECHNICAL_PROBLEM,"")}):Promise.reject(new _.default(I.Qt.NOT_AUTHENTICATED,"the user is not authenticated")):Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,s)):Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,e))},x.prototype.registerUserConsent=function(){var t,n=this;return M.default(R.et,"registerUserConsent call",arguments),this.Ze?(t=O.default.getUser())?t.consent?Promise.resolve({}):"DISCONNECTED"===this.hi.find(I.ci.CONNECTION_STATUS).snapshot.status?Promise.reject(new _.default(I.Qt.DISCONNECTED,"the client is disconnected from the server")):this.Ge.Yo().then(function(t){return O.default.zo(),n.He(O.default.getUser()),{}}):Promise.reject(new _.default(I.Qt.NOT_AUTHENTICATED,"the user is not authenticated")):Promise.reject(new _.default(I.Qt.INVALID_CALL,"feature not supported in the current authentication mode"))},x.prototype.createPoll=function(t,n,i){var e;return M.default(R.et,"createPoll call",arguments),!t||!m.Po(t)||100<m.jo(t)?Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"invalid question argument")):!n||!m.isArray(n)||n.length<2||10<n.length||n.some(function(t){return!m.Po(t)||25<m.jo(t)})?Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"invalid answers argument")):void 0===(i=null==i?void 0:i.multipleChoice)||m.Jo(i)?3!==this.de?Promise.reject(new _.default(I.Qt.INVALID_CALL,"poll is a Premium feature")):this.hi.find(I.ci.LOGIN_STATUS).snapshot.user?!(e=O.default.getDetails())||e.role!==d.default.jt&&e.role!==d.default.Lt?Promise.reject(new _.default(I.Qt.INVALID_CALL,"the user is not a MODERATOR or GUEST")):"DISCONNECTED"===this.hi.find(I.ci.CONNECTION_STATUS).snapshot.status?Promise.reject(new _.default(I.Qt.DISCONNECTED,"the client is disconnected from the server")):(n=n.map(function(t){return t.trim()}),this.Ge.Ko(t,n,i?n.length:1).catch(function(t){var n=t;throw n=t instanceof _.default?n:"ALREADY_PRESENT"===t?new _.default(I.Qt.ALREADY_PRESENT,"there is already an active poll"):"DISABLED"===t?new _.default(I.Qt.CHAT_DISABLED,"the chat was disabled by the Administrator"):new _.default(I.Qt.TECHNICAL_PROBLEM,"")})):Promise.reject(new _.default(I.Qt.NOT_AUTHENTICATED,"the user is not authenticated")):Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"invalid options argument"))},x.prototype.closePoll=function(t){var n;return void 0===t&&(t=!1),M.default(R.et,"closePoll call",arguments),void 0===t||m.Jo(t)?3!==this.de?Promise.reject(new _.default(I.Qt.INVALID_CALL,"poll is a Premium feature")):this.hi.find(I.ci.LOGIN_STATUS).snapshot.user?!(n=O.default.getDetails())||n.role!==d.default.jt&&n.role!==d.default.Lt?Promise.reject(new _.default(I.Qt.INVALID_CALL,"the user is not a MODERATOR or GUEST")):"DISCONNECTED"===this.hi.find(I.ci.CONNECTION_STATUS).snapshot.status?Promise.reject(new _.default(I.Qt.DISCONNECTED,"the client is disconnected from the server")):this.Ge.Xo(t).catch(function(t){var n=t;throw n=t instanceof _.default?n:"NOT_FOUND"===t?new _.default(I.Qt.NOT_FOUND,"there is no active poll"):new _.default(I.Qt.TECHNICAL_PROBLEM,"")}):Promise.reject(new _.default(I.Qt.NOT_AUTHENTICATED,"the user is not authenticated")):Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"invalid remove argument"))},x.prototype.sendVote=function(i){return M.default(R.et,"sendVote call",arguments),i&&m.isArray(i)&&!i.some(function(t){return!m.Wo(t)||!i.every(function(t,n){return i.indexOf(t)===n})})?3!==this.de?Promise.reject(new _.default(I.Qt.INVALID_CALL,"poll is a Premium feature")):this.hi.find(I.ci.LOGIN_STATUS).snapshot.user?"DISCONNECTED"===this.hi.find(I.ci.CONNECTION_STATUS).snapshot.status?Promise.reject(new _.default(I.Qt.DISCONNECTED,"the client is disconnected from the server")):this.Ge.$o(i).catch(function(t){var n=t;throw n=t instanceof _.default?n:"INVALID_VOTE"===t?new _.default(I.Qt.INVALID_ARGUMENTS,"invalid votes argument"):"NOT_FOUND"===t?new _.default(I.Qt.NOT_FOUND,"there is no active poll"):"CLOSED"===t?new _.default(I.Qt.CLOSED,"the current poll has already been closed"):"DISABLED"===t?new _.default(I.Qt.CHAT_DISABLED,"the chat is currently disabled"):new _.default(I.Qt.TECHNICAL_PROBLEM,"")}):Promise.reject(new _.default(I.Qt.NOT_AUTHENTICATED,"the user is not authenticated")):Promise.reject(new _.default(I.Qt.INVALID_ARGUMENTS,"invalid votes argument"))},x.prototype.getPollVote=function(){return M.default(R.et,"getPollVote call",arguments),3!==this.de?Promise.reject(new _.default(I.Qt.INVALID_CALL,"poll is a Premium feature")):this.hi.find(I.ci.LOGIN_STATUS).snapshot.user?"DISCONNECTED"===this.hi.find(I.ci.CONNECTION_STATUS).snapshot.status?Promise.reject(new _.default(I.Qt.DISCONNECTED,"the client is disconnected from the server")):this.Ge.Qo().then(function(t){return{vote:t.vote||[]}}).catch(function(t){var n=t;throw n=t instanceof _.default?n:"NOT_FOUND"===t?new _.default(I.Qt.NOT_FOUND,"there is no active poll"):new _.default(I.Qt.TECHNICAL_PROBLEM,"")}):Promise.reject(new _.default(I.Qt.NOT_AUTHENTICATED,"the user is not authenticated"))},x.prototype.getOlderMessages=function(){var t,i=this,e=(M.default(R.et,"getOlderMessages call",arguments),this.hi.find(I.ci.LIST_CHAT_MESSAGES));return e.jn()?(t=e.snapshot).length?t.length>=f.default.tt?Promise.resolve({messages:[]}):this.Ks.Zo().then(function(t){var n=t.messages,t=t.tu;return t&&0<t.length&&(M.default(R.st,"CHAT add upds",t),e.In(i.Ks.get(),i),t.forEach(function(t){t._snap=e.snapshot;t=new P.ee(t);i.sr(t)})),n}).then(function(t){return{messages:t}}):Promise.reject(new _.default(I.Qt.INVALID_CALL,"the chat subject doesn't contain any messages")):Promise.reject(new _.default(I.Qt.INVALID_CALL,"subscribe the chat subject first"))},x);function x(){var n,i=this;this.version="0.106.0-120-gfdc66af",this.dr={},this.ko=null,this.rs=!1,this.hi=o.default.li(),this.De=!1,this.Ze=!1,this.Ce=!1,this.Te=!1,this.Pe=!1,this.Qe=[],u.default(),this.ye()&&(n=this.Es(),this.Ds(),this.Le=r.default.li(),this.De||top===self||this.Le.init().then(function(t){if(M.default(R.st,"Retrieved context",t),i.context=t,i._ourOrigin=i.context.tn,i._parentOrigin=i.context.Ai,v.default.Ai=i.context.Ai,h.pi())throw new _.default(I.Qt.TECHNICAL_PROBLEM,"Unsupported browser");i.Ne=new T.default(i.context.Zt,i.context.tn,i.context.nn),i.Ne.sn(n).then(function(t){i.start()}).catch(function(t){M.default(R.nt,t),i.ve(t)})}).catch(function(t){i.ve(t)}))}W.ae=J}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,10:10,11:11,12:12,13:13,14:14,15:15,18:18,19:19,2:2,20:20,21:21,23:23,24:24,25:25,26:26,27:27,28:28,3:3,30:30,31:31,32:32,34:34,35:35,36:36,37:37,39:39,41:41,42:42,43:43,44:44,45:45,5:5,6:6,7:7,9:9}],18:[function(t,n,i){var o=this&&this.__assign||function(){return(o=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++)for(var s in n=arguments[i])Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s]);return t}).apply(this,arguments)},s=(Object.defineProperty(i,"t",{value:!0}),t(41)),u=t(1),e=t(7),a=t(2),r=t(43),c=t(45),h=t(44),l=t(35),f=t(2),t=(d.prototype.nu=function(t){this.mode=t?"nore":"oauth",window.addEventListener("message",this.iu,!1)},d.prototype.eu=function(){this.mode=null,window.removeEventListener("message",this.iu)},d.prototype.onError=function(t){this.promise.su(t),this.state.ze(this.state.ru),this.state.ru=void 0,this.reset()},d.prototype.po=function(){return this.authorization},d.prototype.reset=function(){this.ou&&(clearInterval(this.ou),this.ou=void 0),void 0!==this.window&&(this.window.close(),this.window=void 0),this.promise.reset(),this.eu()},d.prototype.yo=function(i){var e=this;return new Promise(function(t,n){e.promise.set(t,n),e.state.ru=e.state.bs,e.state.ze(1),e.nu(i)})},d.prototype.Io=function(){var t,n;null!=(n=(t=this.promise).su)&&n.call(t),this.reset()},d.prototype.uu=function(t,n,i){var e=this,t=(void 0===n&&(n=!1),void 0===i&&(i=!0),window.open(t,"login"));return s.au(t)?Promise.reject(new r.default(h.Qt.BLOCKED,"authentication popup was blocked")):i?(this.window=t,this.state.ru=this.state.bs,this.state.ze(1),this.nu(n),new Promise(function(t,n){e.promise.set(t,n),e.ou=window.setInterval(function(t){try{e.window&&!e.window.opener&&void 0!==u.default.D.file_name?(l.default(f.st,"Found communication issue",e.window,e.window.opener),1===e.state.bs&&e.onError(new r.default(h.Qt.TECHNICAL_PROBLEM,"cannot access authentication page"))):e.window&&e.window.closed&&(l.default(f.st,"Auth window closed"),1===e.state.bs)&&e.onError(new r.default(h.Qt.ABORTED,"closed authentication window"))}catch(t){l.default(f.nt,t)}},u.default.J)})):Promise.resolve({})},d.prototype.cu=function(t,n){var i=u.default.T.widget,t={site:t,lang:i.language};return!1!==n&&(t.wl=n,t.logo=i.logo_url,t.bgColor=i.color_internal_background),t},d.prototype.editUserProfile=function(t,n,i,e){i=c.Ts(u.default.Ee,"email-signin/step1",o({action:"EDIT_PROFILE",userId:i,siteKey:n},this.cu(t,e)));return this.uu(i,!1,!1)},d.prototype._o=function(t,n,i,e,s){var r=u.default.T.widget,n=c.Ts(u.default.Ee,"oauth-signin",o({provider:e?a.default.EMAIL:n,siteKey:e?i:null,cm:e?r.consent_message:null},this.cu(t,s)));return this.uu(n)},d.prototype.Do=function(t,n,i){var e=u.default.T.widget,n=c.Ts(u.default.Ee,"no-registration-signin",o({siteKey:n,cm:e.consent_message},this.cu(t,i)));return this.uu(n,!0)},d.prototype.zo=function(){this.hu=o(o({},this.getUser()),{consent:!0})},d.prototype.Ve=function(t){this.lu=t},d.prototype.Je=function(t){l.default(f.st,"storeDetails",t);var n=t.authentication,i=t.authorization,i=(n&&(this.hu=o({icon:null,consent:!0},n),this.lu=n.id),i&&(this.authorization=i),null),e=t.role,n=(e&&(i={role:(e=s.Gr(e,n&&n.badge,n&&n.badgeFg,n&&n.badgeBg)).role,badge:e.badge}),t.preference);if(n)try{(i=i||{}).preferences=JSON.parse(n)}catch(t){l.default(f.nt,t)}return i&&(this.details=i),this.getUser()},d.prototype.Be=function(){l.default(f.st,"resetDetails"),this.hu=null,this.details=null,this.authorization=null,this.lu=null},d.prototype.Vr=function(t,n){l.default(f.st,"updateRole",t,n);var i=this.details||{};t?(i.role=t,i.badge=n):(delete i.role,delete i.badge),Object.keys(i).length?this.details=i:this.details=null},d.prototype.fu=function(t){l.default(f.st,"updatePreferences",t);var n=this.details||{};t?n.preferences=t:delete n.preferences,Object.keys(n).length?this.details=n:this.details=null},d.prototype.getUser=function(){return this.hu&&s.Tn(this.hu)},d.prototype.$e=function(){return this.lu},d.prototype.getDetails=function(){return this.details&&s.Tn(this.details)},d);function d(){var i=this;this.state={ru:void 0,bs:0,ze:function(t){this.bs=t}},this.Ge=void 0,this.dn=void 0,this.window=void 0,this.ou=void 0,this.promise={du:void 0,su:void 0,set:function(t,n){this.du=t,this.su=n},reset:function(){this.su=this.du=void 0}},this.lu=null,this.iu=function(t){var n=u.default.D.our_origin;t.origin===n&&t&&t.data&&t.data.fn===i.mode+".callback"&&t.data.payload&&(l.default(f.st,"userAppResponseListener",t.data),i.state.ze(2),e.default.dn.vu()&&e.default.dn.wu(),i.ou&&(clearInterval(i.ou),i.ou=void 0),i.promise.du(t.data.payload))}}i.default=new t},{1:1,2:2,35:35,41:41,43:43,44:44,45:45,7:7}],19:[function(t,n,i){Object.defineProperty(i,"t",{value:!0});var e=t(1),s=t(41),r=t(5),o=t(3),u=t(35),a=t(2),t=(c.prototype.init=function(t){var n=this,t=t.authorization;this.state=this.mu(t),(null==(t=null==(t=e.default.T)?void 0:t.custom_auth)?void 0:t.enabled)||r.default.subscribe(o.Bt.Authentication,function(t){t=n.mu((null==t?void 0:t.authorization)||{});s.Oo(n.state,t)||(n.state=t,s.we(n.pu)&&n.pu(t))})},c.prototype.Re=function(t){this.pu=t},c.prototype.ke=function(){return s.Tn(this.perms)},c.prototype.gu=function(t,n,i,e){var s=[];t&&s.push("chatR"),n&&s.push("chatW"),i&&s.push("siteR"),e&&s.push("pageR"),this.perms=s},c.prototype.mu=function(t){function n(t){return!1!==t}u.default(a.st,"computeState",t);var i=n(t.chatR),e=n(t.chatW),s=n(t.siteR),t=n(t.pageR);return this.gu(i,e,s,t),{chatView:i,chatPost:e,siteCounterView:s,pageCounterView:t}},c);function c(){}i.default=new t},{1:1,2:2,3:3,35:35,41:41,5:5}],20:[function(t,n,i){Object.defineProperty(i,"t",{value:!0});var e=t(1),s=t(10),a=t(41),c=t(43),h=t(44),l=e.default.Y,f=t(35),d=t(2);function r(t){this.site=t,this.bu()}r.prototype.Eu=function(){return e.default.L&&s.Pi()},r.prototype.Su=function(){try{return JSON.parse(localStorage.getItem(l)||"{}")}catch(t){return f.default(d.nt,"error parsing browser preferences",t),{}}},r.prototype.bu=function(){if(this.Eu()){var t=this.Su(),n=Object.keys(t);if(n.length){for(var i=0,e=n;i<e.length;i++){var s=e[i],r=t[s]||{},o=Object.keys(r);if(o.length){for(var u=0,a=o;u<a.length;u++){var c=a[u],h=r[c];h.exp&&Date.now()>h.exp&&delete r[c]}Object.keys(r).length||delete t[s]}}Object.keys(t).length?localStorage.setItem(l,JSON.stringify(t)):localStorage.removeItem(l)}}},r.prototype.getItem=function(s){var r=this;return new Promise(function(t,n){if(s&&a.Po(s)){if(r.Eu()){var i=r.Su(),e=i[r.site];if(f.default(d.st,"browserPreferences.getItem",i,e),e){i=e[s];if(i){e=i.exp,i=i.val;if(!e||Date.now()<=e)return void t(i)}}}t(null)}else n(new c.default(h.Qt.INVALID_ARGUMENTS,"key must be a string"))})},r.prototype.setItem=function(s,r,o){var u=this;return new Promise(function(t,n){var i,e;s&&a.Po(s)?void 0!==r&&(a.Po(r)||a.Wo(r)||a.Jo(r))?void 0===o||a.Wo(o)?(u.Eu()&&(i=u.Su(),e={val:r},o&&(e.exp=Date.now()+o),f.default(d.st,"browserPreferences.setItem",i,i[u.site],e),i[u.site]=i[u.site]||{},i[u.site][s]=e,localStorage.setItem(l,JSON.stringify(i))),t()):n(new c.default(h.Qt.INVALID_ARGUMENTS,"expirationInMs must be a number")):n(new c.default(h.Qt.INVALID_ARGUMENTS,"value must be a string, a number or a boolean")):n(new c.default(h.Qt.INVALID_ARGUMENTS,"key must be a string"))})},r.prototype.removeItem=function(s){var r=this;return new Promise(function(t,n){var i,e;s&&a.Po(s)?r.Eu()?(e=(i=r.Su())[r.site],f.default(d.st,"browserPreferences.removeItem",i,e),e&&void 0!==e[s]&&(delete e[s],Object.keys(e).length||delete i[r.site],Object.keys(i).length?localStorage.setItem(l,JSON.stringify(i)):localStorage.removeItem(l),t())):t():n(new c.default(h.Qt.INVALID_ARGUMENTS,"key must be a string"))})},i.default=r},{1:1,10:10,2:2,35:35,41:41,43:43,44:44}],21:[function(t,n,i){Object.defineProperty(i,"t",{value:!0});var e=t(2),s=t(10),r=t(41),o=t(35),u=t(2),t=(a.prototype.Eo=function(){return this.Ou},a.prototype.Pu=function(){this.Ou=!0,o.default(u.st,"SwitchToSessionMode call")},a.prototype.Cu=function(){return s.Pi()||this.Ou?this.Ou?null!==this.Tu:!!localStorage.getItem(e.default.Ut):null},a.prototype.Ro=function(){if(this.Ou)return{userId:this.Tu.id,Ao:this.Tu.secret||null};try{var t=JSON.parse(localStorage.getItem(e.default.Ut));return{userId:t.id,Ao:t.secret}}catch(t){return null}},a.prototype.Mo=function(t,n){void 0===n&&(n=!1),this.Ou||s.Pi()&&!n||this.Pu(),this.Ou?this.Tu=t:localStorage.setItem(e.default.Ut,JSON.stringify(t)),o.default(u.st,"User information stored (for_session="+this.Ou+")",t)},a.prototype.Nu=function(t){s.Pi()&&(localStorage.setItem(e.default.xt,JSON.stringify({val:t,exp:Date.now()+36e5})),o.default(u.st,"control link stored",t))},a.prototype.Du=function(){if(s.Pi())try{var t=localStorage.getItem(e.default.xt),n=t&&JSON.parse(t);if(n){if(Date.now()<n.exp)return n.val;this._u()}}catch(t){o.default(u.nt,"error parsing control link",t),this._u()}return null},a.prototype._u=function(){s.Pi()&&localStorage.removeItem(e.default.xt)},a.prototype.mo=function(){this.Ou?this.Tu=null:localStorage.removeItem(e.default.Ut),o.default(u.st,"DeleteCredential call")},a.prototype.getUser=function(){return this.Cu()?this.Ou?this.Tu:JSON.parse(localStorage.getItem(e.default.Ut)):null},a.prototype.Hr=function(t,n){if(this.Cu()){var i=void 0;if((i=this.Ou?this.Tu:JSON.parse(localStorage.getItem(e.default.Ut)))&&(i.nick!==t||i.icon!==n))return i.nick=t,i.icon=n,this.Mo(i),o.default(u.st,"User info updated",i),!0}return!1},a.prototype.watch=function(i,e){var t;return this.Ou?null:(t=function(t){var n;t.key===i&&(n=JSON.parse(t.newValue||null),t=JSON.parse(t.oldValue||null),r.Oo(n,t)||null!=e&&e(n,t))},window.addEventListener("storage",t),function(){window.removeEventListener("storage",t)})},a);function a(){this.Ou=!1,this.Tu=null}i.default=new t},{10:10,2:2,35:35,41:41}],22:[function(t,n,i){Object.defineProperty(i,"t",{value:!0});var r=t(41),e=t(1),s=t(10),o=t(35),u=t(2);function a(t){this.siteKey=t,this.Eu()||(this.yu={}),o.default(u.st,"StoragePerSite init",t,!!this.yu)}a.prototype.Eu=function(){return e.default.L&&s.Pi()},a.prototype.Su=function(){if(this.yu)return this.yu;try{return JSON.parse(localStorage.getItem(this.siteKey)||"{}")}catch(t){return o.default(u.nt,"error parsing bucket for: "+this.siteKey,t),{}}},a.prototype.Iu=function(){return this.siteKey},a.prototype.getItem=function(t){return this.Su()[t]},a.prototype.setItem=function(t,n){var i=this.Su();return i[t]=n,this.yu||localStorage.setItem(this.siteKey,JSON.stringify(i)),n},a.prototype.removeItem=function(t){var n=this.Su();delete n[t],this.yu||(Object.keys(n).length?localStorage.setItem(this.siteKey,JSON.stringify(n)):localStorage.removeItem(this.siteKey))},a.prototype.watch=function(i,e){var t,s=this;return this.yu?null:(t=function(t){var n;t.key===s.siteKey&&(n=null==(n=JSON.parse(t.newValue||null))?void 0:n[i],t=null==(t=JSON.parse(t.oldValue||null))?void 0:t[i],r.Oo(n,t)||null!=e&&e(n,t))},window.addEventListener("storage",t),function(){window.removeEventListener("storage",t)})},a.prototype.bo=function(){return!this.yu},i.default=a},{1:1,10:10,2:2,35:35,41:41}],23:[function(t,n,i){Object.defineProperty(i,"t",{value:!0});var e=t(40),s=t(3),r=t(41),o=t(35),u=t(2);function a(){this.Mu={},this.Au=new e.default}a.prototype.get=function(t){return this.Mu[t]},a.prototype.set=function(t){var n=t.id,i=!!this.Mu[n],e=i&&r.Oo(t,this.Mu[n]);this.Mu[n]=t,this.Au.publish(n,t),i?e||(this.Au.publish(s.Bt.UserUpdated,t),o.default(u.st,"Updated details for user with id: "+n)):o.default(u.st,"Saved details for user with id: "+n)},a.prototype.watch=function(t,n){return this.Au.subscribe(t,n),o.default(u.st,"Suscribed "+t+" topic"),n},a.prototype.unwatch=function(t,n){this.Au.unsubscribe(t,n),o.default(u.st,"Unsuscribed "+n+" from "+t+" topic")},a.prototype.Ru=function(){return Object.keys(this.Mu)},i.default=a},{2:2,3:3,35:35,40:40,41:41}],24:[function(t,n,i){Object.defineProperty(i,"t",{value:!0});var r=t(41),o=t(18),u=t(43),a=t(44),c=t(35),h=t(2);function e(t,n,i){this.Ge=t,this.Uu=n,this.xu=i}e.prototype.ku=function(t){var n=o.default.getDetails();return n&&n.preferences?t?n.preferences[t]||null:n.preferences:null},e.prototype.ju=function(){var t=o.default.getUser();r.we(this.xu)&&this.xu(t)},e.prototype.getItem=function(t){var n;return c.default(h.et,"userPreferences.getItem call",arguments),void 0===t?Promise.reject(new u.default(a.Qt.INVALID_ARGUMENTS,"invalid key argument")):r.Po(t)?(n=this.Uu()).find(a.ci.LOGIN_STATUS).snapshot.user?"DISCONNECTED"===n.find(a.ci.CONNECTION_STATUS).snapshot.status?Promise.reject(new u.default(a.Qt.DISCONNECTED,"the client is disconnected from the server")):Promise.resolve(this.ku(t)):Promise.reject(new u.default(a.Qt.NOT_AUTHENTICATED,"the user is not authenticated")):Promise.reject(new u.default(a.Qt.INVALID_ARGUMENTS,"key must be a string"))},e.prototype.setItem=function(t,n){var i,e,s=this;return c.default(h.et,"userPreferences.setItem call",arguments),void 0===t?Promise.reject(new u.default(a.Qt.INVALID_ARGUMENTS,"invalid key argument")):r.Po(t)?void 0===n?Promise.reject(new u.default(a.Qt.INVALID_ARGUMENTS,"invalid value argument")):(i=this.Uu()).find(a.ci.LOGIN_STATUS).snapshot.user?"DISCONNECTED"===i.find(a.ci.CONNECTION_STATUS).snapshot.status?Promise.reject(new u.default(a.Qt.DISCONNECTED,"the client is disconnected from the server")):((e=this.ku()||{})[t]=n,this.Ge.Lu(JSON.stringify(e)).then(function(t){o.default.fu(e),s.ju()}).catch(function(t){var n=t;throw n=t instanceof u.default?n:"VALUE_TOO_LONG"===t?new u.default(a.Qt.QUOTA_EXCEEDED,"not enough remaining space for writing this key"):new u.default(a.Qt.TECHNICAL_PROBLEM,"")})):Promise.reject(new u.default(a.Qt.NOT_AUTHENTICATED,"the user is not authenticated")):Promise.reject(new u.default(a.Qt.INVALID_ARGUMENTS,"key must be a string"))},e.prototype.removeItem=function(t){var n,i,e=this;return c.default(h.et,"userPreferences.removeItem call",arguments),void 0===t?Promise.reject(new u.default(a.Qt.INVALID_ARGUMENTS,"invalid key argument")):r.Po(t)?(n=this.Uu()).find(a.ci.LOGIN_STATUS).snapshot.user?"DISCONNECTED"===n.find(a.ci.CONNECTION_STATUS).snapshot.status?Promise.reject(new u.default(a.Qt.DISCONNECTED,"the client is disconnected from the server")):(delete(i=this.ku()||{})[t],this.Ge.Lu(Object.keys(i).length?JSON.stringify(i):null).then(function(t){o.default.fu(Object.keys(i).length?i:null),e.ju()})):Promise.reject(new u.default(a.Qt.NOT_AUTHENTICATED,"the user is not authenticated")):Promise.reject(new u.default(a.Qt.INVALID_ARGUMENTS,"key must be a string"))},i.default=e},{18:18,2:2,35:35,41:41,43:43,44:44}],25:[function(t,n,i){var l=this&&this.__assign||function(){return(l=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++)for(var s in n=arguments[i])Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s]);return t}).apply(this,arguments)},s=this&&this.__spreadArrays||function(){for(var t=0,n=0,i=arguments.length;n<i;n++)t+=arguments[n].length;for(var e=Array(t),s=0,n=0;n<i;n++)for(var r=arguments[n],o=0,u=r.length;o<u;o++,s++)e[s]=r[o];return e},v=(Object.defineProperty(i,"t",{value:!0}),t(35)),w=t(2),m=t(41),p=t(2),o=t(1),d=t(18),u=t(40),e=t(38);function r(){this.Fu=new e.default(!0,1e4,"cm"),this.Gu=!1,this.Ju=null,this.Hu=null,this.Vu=!1,this.Wu=null,this.Bu=1e4,this.qu=!1,this.Yu=null}r.li=function(){return r.fi=r.fi?r.fi:new r},r.prototype.Zo=function(i){var s=this;return void 0===i&&(i=20),new Promise(function(e,n){if(0===s.zu.length)return v.default(w.nt,"Cannot load older messages: chat list is empty"),n(new Error("Chat list is empty"));var t=s.zu[0].id;v.default(w.st,"Requesting "+i+" older messages before message "+t),s.getOlderMessages(t,i,s.lr.Ru()).then(function(t){var n=t.m||[],i=t.u||{},t=t.o||{};if(!i||!n)return v.default(w.nt,"Invalid response from getOlderMessages"),e({messages:[],tu:[]});s.Vu=!0,v.default(w.st,"Older messages loaded, enabling custom expiration handling");n=s.Ku(n,i,t),i=n.map(function(t){return l({action:"ADD"},t)});(t=s.zu).unshift.apply(t,n),0<n.length&&!s.qu&&(v.default(w.st,"Auto-starting message cleanup cycle after loading "+n.length+" older messages"),s.Qs()),e({messages:n,tu:i})}).catch(function(t){v.default(w.nt,"Error loading older messages:",t),n(t)})})},r.prototype.init=function(n,t,i,e,s,r){if(v.default(w.st,"ChatManager init with parameters:",{hr:n?"provided":"not provided",getOlderMessages:t?"provided":"not provided",lr:i?"provided":"not provided",Xu:e,$u:s?new Date(s):"not provided",Yu:r?"provided":"not provided"}),this.zu=[],this.Qu=[],this.hr=n,this.Xu=e||null,this.$u=s||null,this.getOlderMessages=t||null,this.Yu=r||null,this.lr=i,this.Zu={},this.ta=new u.default,"api"!==o.default.T.target){n="(?:[\\u{1F1E6}-\\u{1F1FF}]{2}|\\u{1F3F4}.{1,10}\\u{E007F}|(?:[\\p{Emoji_Presentation}\\p{Other_Symbol}]\\uFE0F?|[\\p{Letter}\\p{Number}\\p{Symbol}\\p{Punctuation}]\\uFE0F)[\\p{Emoji_Modifier}\\p{Enclosing_Mark}]*(?:\\u200D[\\p{Emoji}\\p{Number}\\p{Symbol}\\p{Punctuation}\\p{Enclosing_Mark}]\\uFE0F?\\p{Emoji_Modifier}*)*)";try{this.na=new RegExp(n+"(?<!\\uFE0E)","gu")}catch(t){v.default(w.nt,"Error parsing emoji regex",t),this.na=new RegExp(n,"gu")}}},r.prototype.Yr=function(t){v.default(w.st,"Updating messageExpirationTime from "+this.Xu+" to "+t+" ms"),this.Xu=t},r.prototype.zr=function(t){var n=this.$u?new Date(this.$u).toISOString():"not set",i=t?new Date(t).toISOString():"not set";v.default(w.st,"Updating chatFlushDate from "+n+" to "+i),this.$u=t},r.prototype.get=function(){return this.zu},r.prototype.ia=function(i){var e=this;return new Promise(function(n){for(var t=0;t<e.zu.length;t++)if(e.zu[t].id===i)return v.default(w.st,"msg resolved from snapshot",e.zu[t]),void n(e.zu[t]);e.Zu[i]?(v.default(w.st,"msg resolved from outdates",e.Zu[i]),n(e.Zu[i])):e.ta.subscribe(i,function(t){v.default(w.st,"msg resolved",t),n(t)})})},r.prototype.Fr=function(t){var n=this,i=m.Rr(t.getValue,t),e=i(p.default.ft),s=i(p.default.lt),r=i("i"),o=i("u"),u=i("p"),a=i("s"),c=i("r"),h=i("d"),i=(v.default(w.st,"Chat handle "+e+" "+s,this.Fu.ea()),t.isSnapshot()),t=!1,l=(!i||this.Gu||(this.Gu=!0,this.Qu=[],this.Hu=[],t=!0),i?this.Qu:this.zu);switch(e){case p.default.dt:var f,d="o"!==a?(f=[this.hr(o)],c&&f.push(this.ia(c)),this.Fu.add(function(t){return Promise.all(f)}).then(function(t){return n.sa(l,s,r,u,h,t[0],t[1])})):this.Fu.add(function(t){return n.hr(o)}).then(function(t){return n.ra(s,r,u,h,t)});break;case p.default.vt:d=this.Fu.add(function(t){return n.ia(s)}).then(function(t){return n.oa(l,s,!0)});break;case p.default.UPDATE:d="o"===a?this.Fu.add(function(t){return n.ia(s)}).then(function(t){return n.oa(l,s,!1)}):this.Fu.add(function(t){return n.ia(s)}).then(function(t){return n.ua(l,t,h,u)});break;default:d=Promise.resolve(null)}return i&&d&&this.Hu.push(d),i?t?new Promise(function(t){n.Ju=t,v.default(w.st,"Started processing snapshot")}):Promise.resolve([]):d},r.prototype.sa=function(t,n,i,e,s,r,o){var u=this.aa(n,i,e,s,r,o);if(0===t.length)v.default(w.st,"insert "+n+" at head",t.length),t.push(u);else for(var a=t.length-1;0<=a;a--){if(u.time>=t[a].time){v.default(w.st,"insert "+n+" at index "+(a+1),t.length),t.splice(a+1,0,u);break}0===a&&(v.default(w.st,"insert "+n+" at head",t.length),t.unshift(u))}return this.ta.publish(n,u),this.ta.ca(n),[l({action:"ADD"},u)]},r.prototype.oa=function(n,t,i){for(var e=this,s=-1,r=0;r<n.length;r++)if(t===n[r].id){s=r;break}if(-1===s)return[];if(this.Vu&&n===this.zu){for(var o=Date.now(),u=[],a=[],r=0;r<=s;r++){var c=n[r];this.ha(c,o)&&(u.push(c),a.push(r),this.Zu[c.id]=c)}for(r=a.length-1;0<=r;r--)n.splice(a[r],1);return v.default(w.st,"Expired messages removal: "+u.length+" messages removed based on expiration time"),u.map(function(t){t=e.aa(t.id,null,null,null,null);return l({action:"REMOVE"},t)})}for(u=[],a=[],r=0;r<=s;r++){c=n[r];u.push(c),a.push(r)}1<u.length&&v.default(w.st,"Message "+t+" expired: Removing "+(u.length-1)+" older messages as well",u.map(function(t){return t.id})),u.forEach(function(t){n===e.zu&&(i?delete e.Zu[t.id]:e.Zu[t.id]=t)});for(r=a.length-1;0<=r;r--)n.splice(a[r],1);return u.map(function(t){t=e.aa(t.id,null,null,null,null);return l({action:"REMOVE"},t)})},r.prototype.ha=function(t,n){if(!t.time)return!1;if(this.Xu&&t.time+this.Xu<n)return!0;return!!(this.$u&&t.time<this.$u)},r.prototype.ua=function(t,n,i,e){for(var s,r=-1,o=0;o<t.length;o++)if(n.id===t[o].id){r=o;break}if(-1===r)return t===this.zu?this.la(n):this.sa(t,n.id,null==(s=n.time)?void 0:s.toString(16),n.message,n.deleted,n.author);if(n.moderated||e)return[];for(var u=t[r],a=this.aa(u.id,u.time.toString(16),null,i,u.author,null),c=(t.splice(r,1,a),[l({action:"UPDATE"},a)]),o=0;o<t.length;o++){var h=t[o];h.repliesTo&&h.repliesTo.id===u.id&&(h.repliesTo=a,t.splice(o,1,h),c.push(l({action:"UPDATE"},h)))}return c},r.prototype.la=function(t){var n=t,i=n.id;if(0===this.zu.length)v.default(w.st,"reinsert "+i+" at head",this.zu.length),this.zu.push(n);else for(var e=this.zu.length-1;0<=e;e--){if(n.time>=this.zu[e].time){v.default(w.st,"reinsert "+i+" at index "+(e+1),this.zu.length),this.zu.splice(e+1,0,n);break}0===e&&(v.default(w.st,"reinsert "+i+" at head",this.zu.length),this.zu.unshift(n))}return this.ta.publish(i,n),this.ta.ca(i),delete this.Zu[i],[l({action:"ADD"},n)]},r.prototype.Wr=function(){var n=this;return v.default(w.st,"endOfSnapshot"),this.Gu?this.Fu.add(function(t){return Promise.all(n.Hu).then(function(){return n.fa()})}).then(function(t){return[]}):this.Fu.add(function(t){return n.fa()})},r.prototype.fa=function(){var h=this;return new Promise(function(i){v.default(w.st,"Started finalizing snapshot"),v.default(w.st,"[32m"+JSON.stringify(h.Qu,null,2)+"[0m\n[34m"+JSON.stringify(h.zu,null,2)+"[0m");var n=Date.now(),e=h.zu.filter(function(t){return h.Xu&&t.time&&t.time+h.Xu<n?(v.default(w.st,"Filtering out expired message: "+t.id,t.time),!1):!(h.$u&&t.time&&t.time<h.$u&&(v.default(w.st,"Filtering out message older than chatFlushDate: "+t.id,"Message time: "+new Date(t.time).toISOString()+", FlushDate: "+new Date(h.$u).toISOString()),1))}),s=(v.default(w.st,"Filtered chatList from "+h.zu.length+" to "+e.length+" messages"),{}),r=(e.forEach(function(t){s[t.id]=t}),null),t=!1;if(0<h.Qu.length&&0<e.length&&h.Qu[0].id===e[0].id)r=h.Qu[0].id,t=!0,v.default(w.st,"Overlap found at oldest message in both lists: "+r);else for(var o=0;o<h.Qu.length;o++)if(s[h.Qu[o].id]){r=h.Qu[o].id;break}var u,a,c=!!r;v.default(w.st,"Lists "+(c?"have":"do not have")+" overlap",c?"Message ID: "+r+", at oldest: "+t:""),c?t?(v.default(w.st,"Using snapshot-only strategy because overlap is at oldest message"),a=h.da(),h.va(i,a,!c)):h.getOlderMessages?1e3<(u=t=e.findIndex(function(t){return t.id===r}))?(v.default(w.st,"Overlap index ("+u+") exceeds maximum getOlderMessages limit (1000), using snapshot-only strategy"),a=h.da(),h.va(i,a,!c)):(t=e[t].time,t=m.wa(t),v.default(w.st,"Calling getOlderMessages with: "+r+", "+u+", "+t),h.getOlderMessages(r,u,h.lr.Ru(),t).then(function(t){var n;v.default(w.st,"getOlderMessages succeeded, received "+((null==(n=t.m)?void 0:n.length)||0)+" messages"),t=t&&t.u&&t.m&&0<t.m.length?(n=h.Ku(t.m,t.u,t.o),h.ma(e,n)):(v.default(w.st,"getOlderMessages returned empty list, local messages are up-to-date"),h.pa(e,h.Qu)),h.va(i,t,!c)}).catch(function(t){v.default(w.nt,"getOlderMessages failed with error",t);t=h.da();h.va(i,t,!c)})):(v.default(w.st,"No getOlderMessages available, using snapshot-only strategy"),a=h.da(),h.va(i,a,!c)):(a=h.da(),h.va(i,a,!c))})},r.prototype.Ku=function(t,c,h){var l=this;if(!c||!t)return v.default(w.nt,"Invalid response from getOlderMessages"),[];v.default(w.st,"Processing "+t.length+" older messages");var f={};return t.forEach(function(t){f[t.k]=t}),t.map(function(t){var n=t.u,i=c[n];if(!i&&l.lr&&(e=l.lr.get(n))&&(i={n:e.name,i:e.pic,p:e.provider},v.default(w.st,"Found author for message "+t.k+" in userInfoCache")),!i)return v.default(w.nt,"Could not find user for message "+t.k+" in users object or userInfoCache",t),null;var e=null;if(t.r){var s=t.r;if(h&&h[s])e=h[s],v.default(w.st,"Message "+t.k+" replies to expired message "+s);else{if(!f[s])return v.default(w.nt,"Message "+t.k+" replies to message "+s+" not found in available messages, discarding"),null;var r,o=f[s],u=o.u,a=c[u];if(!a&&l.lr&&(r=l.lr.get(u))&&(a={n:r.name,i:r.pic,p:r.provider},v.default(w.st,"Found reply author for message "+s+" in userInfoCache")),!a)return v.default(w.nt,"Could not find reply author for message "+s+", discarding message "+t.k),null;e=l.aa(o.k,o.i,o.p,o.d,{id:u,name:a.n,pic:a.i,provider:a.p}),v.default(w.st,"Message "+t.k+" replies to message "+s+" found in messages list")}}return l.aa(t.k,t.i,t.p,t.d,{id:n,name:i.n,pic:i.i,provider:i.p},e)}).filter(function(t){return null!==t})},r.prototype.da=function(){return v.default(w.st,"Using snapshot-only strategy"),s(this.Qu)},r.prototype.ma=function(i,t){var e={};return i.forEach(function(t,n){e[t.id]={message:t,index:n}}),v.default(w.st,"Applying "+t.length+" updated messages to "+i.length+" filtered messages"),t.forEach(function(t){var n;e[t.id]&&(n=e[t.id].index,i[n]=t,v.default(w.st,"Updated message: "+t.id))}),this.pa(i,this.Qu)},r.prototype.pa=function(t,n){var i={},e=(t.forEach(function(t){i[t.id]=!0}),v.default(w.st,"Merging "+t.length+" local messages with "+n.length+" snapshot messages"),s(t));return n.forEach(function(t){i[t.id]||(e.push(t),v.default(w.st,"Added new message from snapshot: "+t.id))}),e.sort(function(t,n){return t.time-n.time}),e},r.prototype.ga=function(t){var i=d.default.$e();return t.map(function(t){var n;return t.author&&t.isMine!==(t.author.id===i)?((n=m.Tn(t)).isMine=t.author?t.author.id===i:null,n):t})},r.prototype.va=function(t,n,i){var n=this.ga(n),e=this.ba(this.zu,n),s=!1;this.Vu&&i&&(s=!0,v.default(w.st,"No overlap between lists and older messages were loaded, sending RESET update"),e.unshift({action:"RESET"}),this.Vu=!1),v.default(w.st,"Finalized snapshot with "+e.length+" updates"+(s?" (including RESET)":"")+", new chat list has "+n.length+" messages"),this.zu=n,this.Ju&&this.Ju(e),this.Gu=!1,this.Ju=null,this.Qu=[],this.Hu=[],t(e)},r.prototype.ba=function(t,n){var i=this,e=[],s={},r=(t.forEach(function(t){s[t.id]=t}),{});return n.forEach(function(t){r[t.id]=t}),v.default(w.st,"Calculating updates: "+t.length+" messages in old list, "+n.length+" in new list"),t.forEach(function(t){var n;r[t.id]||(n=i.aa(t.id,null,null,null,null),e.push(l({action:"REMOVE"},n)),v.default(w.st,"Generated REMOVE for message: "+t.id))}),n.forEach(function(t){var n=s[t.id];n?i.Ea(n,t)&&(e.push(l({action:"UPDATE"},t)),v.default(w.st,"Generated UPDATE for message: "+t.id)):(e.push(l({action:"ADD"},t)),v.default(w.st,"Generated ADD for message: "+t.id))}),e},r.prototype.Ea=function(t,n){return JSON.stringify(t)!==JSON.stringify(n)},r.prototype.aa=function(t,n,i,e,s,r){var o,u=d.default.$e();if(!i)switch(e){case"u":o="BY_AUTHOR";break;case"d":o="BY_ADMINISTRATOR";break;case"m":o="BY_MODERATOR";break;case"n":o="BY_NOW4REAL";break;case"r":o="BY_AI";break;default:o="UNKNOWN"}e={id:t,author:s||null,message:i||null,time:m.kr(n),isMine:s?s.id===u:null};if(o&&(e.deleted=o),r&&(e.repliesTo=r),i&&this.na)try{for(var a=i.matchAll(this.na),c=i,h=0,l=a.next();!l.done;){var f=l.value[0];if(h+=1,c=c.replace(f,""),3<h)break;l=a.next()}0<h&&h<4&&!c.trim().length&&(e.emojisCount=h)}catch(t){v.default(w.nt,"match error",t)}return e},r.prototype.ra=function(t,n,i,e,s){n=this.aa(t,n,i,e,s);return this.Zu[t]=n,this.ta.publish(t,n),this.ta.ca(t),null},r.prototype.Hr=function(t){for(var n=[],i=0;i<this.zu.length;i++){var e=this.zu[i],s=m.Tn(e),r=!1;e.author.id===t.id&&(s.author=t,r=!0),e.repliesTo&&e.repliesTo.id===t.id&&(s.repliesTo.author=t,r=!0),r&&(this.zu.splice(i,1,s),n.push(l({action:"UPDATE"},s)))}return n},r.prototype.wo=function(){var s=this;this.Fu.vo();return this.Fu.add(function(t){return Promise.resolve((()=>{for(var t=s.get(),n=[],i=0;i<t.length;i++){var e=t[i],e=s.aa(e.id,null,null,null,null);n.push(l({action:"REMOVE"},e))}return s.zu=[],s.Zu={},n})())})},r.prototype.snapshot=function(){for(var t=this.get(),n=[],i=0;i<t.length;i++)n.push(l({action:"ADD"},t[i]));return n},r.prototype.vo=function(){this.Fu.vo()},r.prototype.Qs=function(t){this.Xs(),t&&0<t&&(this.Bu=t),this.qu=!0,v.default(w.st,"Starting automatic message cleanup cycle every "+this.Bu+"ms"),this.Sa()},r.prototype.Xs=function(){null!==this.Wu&&(clearTimeout(this.Wu),this.Wu=null,this.qu=!1,v.default(w.st,"Stopped automatic message cleanup cycle"))},r.prototype.Sa=function(){var n=this;this.qu&&(this.Wu=setTimeout(function(){n.Oa().then(function(){n.Sa()}).catch(function(t){v.default(w.nt,"Error in cleanup cycle",t),n.Sa()})},this.Bu))},r.prototype.Oa=function(){var u=this;return!this.Xu&&!this.$u||0===this.zu.length?Promise.resolve([]):this.Fu.add(function(t){return new Promise(function(t){var n=Date.now(),i=[],e=[];v.default(w.st,"Running cleanup cycle at "+new Date(n).toISOString());for(var s=0;s<u.zu.length;s++){var r=u.zu[s];u.ha(r,n)&&(i.push(r),e.push(s),v.default(w.st,"Message "+r.id+" marked for removal: expired"))}if(0===i.length)v.default(w.st,"No expired messages found during cleanup cycle"),t([]);else{for(s=e.length-1;0<=s;s--)u.zu.splice(e[s],1);v.default(w.st,"Cleanup cycle removed "+i.length+" expired messages");var o=i.map(function(t){t=u.aa(t.id,null,null,null,null);return l({action:"REMOVE"},t)});if(u.Yu)try{u.Yu(o)}catch(t){v.default(w.nt,"Error in cleanup callback",t)}t(o)}})})},i.default=r},{1:1,18:18,2:2,35:35,38:38,40:40,41:41}],26:[function(t,n,i){var a=this&&this.__assign||function(){return(a=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++)for(var s in n=arguments[i])Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s]);return t}).apply(this,arguments)},c=(Object.defineProperty(i,"t",{value:!0}),t(35)),h=t(2),l=t(41);function e(){this.Pa={}}e.li=function(){return e.fi=e.fi?e.fi:new e},e.prototype.init=function(t){this.Pa[t]={},c.default(h.st,"Initialized "+t+" heatmap")},e.prototype.get=function(t){return this.Pa[t]},e.prototype.Fr=function(n,t){var i,e,s,r=this,t=l.Rr(t.getValue,t),o=t("c"),t=t("h"),u=[];return o&&t?(i=a({},this.Pa[n]),e=l.Ca(o,t),c.default(h.st,"handle "+n+" heatmap",o,t,e),(s=Object.keys(e)).length&&s.forEach(function(t){r.Pa[n][t]=e[t],u.push({country:t,intensity:e[t]}),delete i[t]}),(o=Object.keys(i)).length&&(c.default(h.st,"missing on "+n+" heatmap",o),o.forEach(function(t){delete r.Pa[n][t],u.unshift({country:t,intensity:0})}))):(s=Object.keys(this.Pa[n])).length&&s.forEach(function(t){delete r.Pa[n][t],u.push({country:t,intensity:0})}),u},e.prototype.wo=function(t){var n,i=[];for(n in this.get(t))i.push({country:n,intensity:null});return this.Pa[t]={},i},e.prototype.snapshot=function(t){var n,i=this.get(t),e=[];for(n in i)e.push({country:n,intensity:i[n]});return e},i.default=e},{2:2,35:35,41:41}],27:[function(t,n,i){var h=this&&this.__assign||function(){return(h=Object.assign||function(t){for(var n,i=1,e=arguments.length;i<e;i++)for(var s in n=arguments[i])Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s]);return t}).apply(this,arguments)},l=(Object.defineProperty(i,"t",{value:!0}),t(35)),f=t(2),d=t(41),a=t(2),u=t(1);function e(){this.Ta={}}e.li=function(){return e.fi=e.fi?e.fi:new e},e.prototype.init=function(t,n,i){this.Ta[t]={map:{},buffer:{}},l.default(f.st,"Initialized "+t+" ranking"),this.Le=n,this.De=i},e.prototype.get=function(t,n){void 0===n&&(n=!1);var i,e=[],s=this.Ta[t].map;for(i in s){var r=d.Tn(s[i]);n&&delete r.position,e[s[i].position-1]=r}return e},e.prototype.Fr=function(t,n){var i=d.Rr(n.getValue,n),e=t.id,s=i(a.default.ft),r=i(a.default.lt),o=this.Na(n,t),u=this.Ta[e].buffer;switch(s){case a.default.dt:u[r]=o,l.default(f.st,r+" ranking: adding "+r);break;case a.default.UPDATE:u[r]=o,l.default(f.st,r+" ranking: updating "+r);break;case a.default.vt:delete u[r],l.default(f.st,r+" ranking: deleting "+r)}if(this.Da(e)){i=this._a(e);if(i)return this.Ta[e].map=d.Tn(u),i}return null},e.prototype._a=function(t){var n,i=this.Ta[t].buffer,e=this.Ta[t].map,s=0,r=0,o=0,u=[];for(n in e)void 0===i[n]&&(s++,u.push(h({action:"LEAVE",key:e[n].key,position:null,users:e[n].users,title:e[n].title,url:e[n].url,isCurrentPage:e[n].isCurrentPage},this.De&&{favicon:e[n].favicon})));for(n in i){var a=d.Tn(i[n]),c=e[n];void 0===c?(r++,a.action="ENTER",u.push(a)):d.Oo(c,a)||(o++,a.action="UPDATE",u.push(a))}return l.default(f.st,"Diff "+t+" ranking: "+r+" add, "+o+" upd, "+s+" del",i,e),u},e.prototype.Da=function(t){for(var n=this.Ta[t].buffer,t=Object.keys(n),i=t.length,e=t.map(function(t){return n[t].position}),s=1;s<=i;s++)if(-1===e.indexOf(s))return!1;return!0},e.prototype.Na=function(t,n){var i,t=d.Rr(t.getValue,t),e=t(a.default.ft),s=t(a.default.lt),r=t("i")?Number(t("i"))+1:"",o={};return(o[a.default.lt]=s).startsWith(u.default.j)?(o.url=null,o.title=2===n.context?"Now4real Shared Public Sandbox":"Now4real Sandbox: "+s.substring(u.default.j.length)):(n=("s"===t("p")?"https":"http")+"://"+s,i=t("t"),o.url=n,i?o.title=i:(i=d.Ie(n),o.title=i.pathname+i.search+i.hash)),o.users=t("c"),o.position=r,o.isCurrentPage=this.Le.ya(s),this.De&&(o.favicon=t("f")),e===a.default.vt&&(o.url=o.title=o.users="",this.De)&&(o.favicon=""),o},e.prototype.Kr=function(){return h({action:"INIT",key:null,position:null,users:null,title:null,url:null,isCurrentPage:null},this.De&&{favicon:null})},e.prototype.wo=function(t){for(var n=this.get(t),i=[],e=0;e<n.length;e++)i.push(h({action:"LEAVE",key:n[e].key,position:null,users:null,title:null,url:null,isCurrentPage:null},this.De&&{favicon:null}));return this.Ta[t]={map:{},buffer:{}},i},e.prototype.snapshot=function(t){for(var n=this.get(t),i=[],e=0;e<n.length;e++)i.push(h({action:"ENTER"},n[e]));return i},i.default=e},{1:1,2:2,35:35,41:41}],28:[function(t,n,i){Object.defineProperty(i,"t",{value:!0});var s=t(35),r=t(2),o=t(41),u=t(2),e=t(38);function a(){this.Fu=new e.default(!0,1e4,"tm"),this.Ia={}}a.li=function(){return a.fi=a.fi?a.fi:new a},a.prototype.init=function(t){this.hr=t,this.Ia={},s.default(r.st,"Initialized typing")},a.prototype.get=function(){var n=this;return Object.keys(this.Ia).map(function(t){return n.Ia[t]})},a.prototype.Fr=function(t){var n=this,t=o.Rr(t.getValue,t),i=t(u.default.ft),e=t(u.default.lt);switch(s.default(r.st,"Typing handle "+i+" "+e,this.Fu.ea()),i){case u.default.dt:return this.Fu.add(function(t){return n.hr(e)}).then(function(t){return s.default(r.st,"Adding "+e+" to typing"),n.Ia[e]=t}).then(function(t){return{action:"START",user:t}});case u.default.vt:return this.Fu.add(function(t){return n.hr(e)}).then(function(t){return s.default(r.st,"Deleting "+e+" from typing"),delete n.Ia[e],t}).then(function(t){return{action:"STOP",user:t}});default:return Promise.reject("Unsupported typing command")}},a.prototype.wo=function(){var s=this;this.Fu.vo();return this.Fu.add(function(t){return Promise.resolve((()=>{for(var t=[],n=0,i=s.get();n<i.length;n++){var e=i[n];t.push({action:"STOP",user:e})}return s.Ia={},t})())})},a.prototype.snapshot=function(){for(var t=[],n=0,i=this.get();n<i.length;n++){var e=i[n];t.push({action:"START",user:e})}return t},a.prototype.vo=function(){this.Fu.vo()},i.default=a},{2:2,35:35,38:38,41:41}],29:[function(t,n,i){Object.defineProperty(i,"t",{value:!0});var s=t(35),r=t(2);function o(){}o.Ma=function(t){var i={},t=t.getAllResponseHeaders();return t&&t.trim().split(/[\r\n]+/).forEach(function(t){var t=t.split(": "),n=t.shift(),t=t.join(": ");i[n]=t}),i},o.an=function(e){return new Promise(function(t,n){var i=new XMLHttpRequest;i.onreadystatechange=function(){i.readyState===XMLHttpRequest.DONE&&(200===i.status||304===i.status?t({responseText:i.responseText,en:o.Ma(i)}):n(o.Aa(i.status,i.statusText)))},i.ontimeout=function(){n(o.Aa(408,"client timeout"))},i.open("GET",e,!0),i.timeout=6e4,i.send(),s.default(r.st,"GET: "+e)})},o.Aa=function(t,n){return{statusCode:t,statusText:n}},i.default=o},{2:2,35:35}],30:[function(t,n,i){Object.defineProperty(i,"t",{value:!0});var e=t(35),s=t(2),r=t(1),o=t(18),u=t(3),a=t(41);function c(t,n){var i=this;this.Ra=void 0,this.Ua=!1,this.xa=!0,this.ka=function(t){"DISCONNECTED"!==t||i.le.he()||i.vu()||2===o.default.state.bs||i.ja(void 0!==i.Ra)},this.La=t,this.le=n,this.La.subscribe(u.Bt.PageHiding,this.reduce.bind(this)),this.La.subscribe(u.Bt.PageShowing,this.reset.bind(this)),this.La.subscribe(u.Bt.ConnectionStatus,function(t){i.xa="DISCONNECTED"===t})}c.prototype.init=function(t,n){this.Fa=t,this.Ga=n},c.prototype.vu=function(){return this.Ua},c.prototype.wu=function(){this.vu()&&(this.Ua=!1,this.Ja())},c.prototype.Ja=function(){var n=this;e.default(s.st,"startListening"),this.La.subscribe(u.Bt.ConnectionStatus,this.ka),this.Ra=window.setTimeout(function(t){n.ja(void 0!==n.Ra)},r.default.H)},c.prototype.Ha=function(){e.default(s.st,"stopListening"),clearTimeout(this.Ra),this.Ra=void 0,this.La.unsubscribe(u.Bt.ConnectionStatus,this.ka)},c.prototype.ja=function(t){e.default(s.st,"fire",t),this.Ua=!0,a.we(this.Fa)&&this.Fa(),t&&this.Ha()},c.prototype.reduce=function(){this.Ua=!1,this.xa?this.ka("DISCONNECTED"):this.Ja()},c.prototype.reset=function(){this.vu()?(this.Ua=!1,a.we(this.Ga)&&this.Ga()):this.Ha()},i.default=c},{1:1,18:18,2:2,3:3,35:35,41:41}],31:[function(t,n,i){Object.defineProperty(i,"t",{value:!0});var e=t(35),s=t(2),r=t(1),o=t(3);function u(t,n){var i=this;this.Va=function(t){"DISCONNECTED"===t?i.set():i.reset()},this.La=t,this.Wa=n}u.prototype.ho=function(){e.default(s.st,"activated"),this.La.subscribe(o.Bt.ConnectionStatus,this.Va)},u.prototype.do=function(){e.default(s.st,"deactivated"),this.reset(),this.La.unsubscribe(o.Bt.ConnectionStatus,this.Va)},u.prototype.set=function(){this.Ba||(this.Ba=window.setTimeout(this.Wa,r.default.V))},u.prototype.reset=function(){this.Ba&&(clearTimeout(this.Ba),this.Ba=null)},i.default=u},{1:1,2:2,3:3,35:35}],32:[function(t,n,i){Object.defineProperty(i,"t",{value:!0});var h=t(41),l=t(2),f=t(1),e=t(39),a=t(13),c=t(34),s=t(43),r=t(44),d=t(35),v=t(2);function o(){}o.li=function(){return o.fi=o.fi?o.fi:new o},o.prototype.init=function(){var n=this;return this.qa().then(function(t){return n.context=t}).catch(function(t){throw new s.default(r.Qt.TECHNICAL_PROBLEM,"Invalid location")})},o.prototype.update=function(t,n){d.default(v.st,"Update context",t=void 0===t?null:t,n=void 0===n?null:n);var i=this.Ya();return this.context&&i===this.context.za?(t&&(this.context.Zt=t,this.context.Ar=this.context.Zt+this.context.Se,this.context.Mr=this.context.Zt+"/"),n&&(this.context.Oe=n,this.context.Ir=n+"/")):this.context=this.Ka(i,t,n),this.context},o.prototype.ya=function(t){return this.context.Zt+this.context.Se===t},o.prototype.qa=function(){var e=this,s=this.Ya();return new Promise(function(n,i){s?void 0===f.default.D.file_name?e.Xa(s).then(function(t){return e.Ka(s)}).then(function(t){/\.googleusercontent\.com$/.test(t.Zt)?(d.default(v.nt,"Now4real is not compatible with the site: "+t.Zt),i("Invalid site")):n(t)}).catch(function(t){i(t)}):n(e.Ka(s)):i("Invalid referrer")})},o.prototype.Ka=function(t,n,i){d.default(v.st,"Creating context",t,n=void 0===n?null:n,i=void 0===i?null:i);var e=this.$a(t),n=n||this.Co(t),i=i||null,s=void 0===f.default.D.file_name?this.Qa(t,!1):null,r=this.To(),o=!!s&&s.endsWith(l.default.kt);return{za:t,Zt:n,Se:e,Oe:i,Ar:n+e,Mr:n+"/",Ir:i?i+"/":null,Ai:s,tn:r,nn:o}},o.prototype.Ya=function(){var t=document.customReferrer,t=t||f.default.D.location;return t},o.prototype.Za=function(t,n){var i,e;return(t=(n=void 0===n?!0:n)&&(t&&(n=h.Ie(t))&&(n.hostname.endsWith(l.default.kt)?(e=t.match(/[^-]*-[^-]*-(.+)\.translate\.goog(.*)/))&&(t=n.protocol+"//"+e[1].replace(/-/g,".")+(e[2]||"/")):new RegExp("^"+l.default.bt+"$|^127(?:.[0-9]{1,3}){3}$").test(n.hostname)&&(e=n.pathname,i=n.search,n=n.hash,/file:\/\//i.test(e)&&(e="/"+e.split("/").pop()),t=l.default.gt+"://"+f.default.j+e+i+n)),void 0!==(e=f.default.D.file_name))?l.default.gt+"://"+f.default.j+"/"+e:t)?(d.default(v.st,"Computed referrer: "+t),t):(d.default(v.nt,"Empty referrer"),null)},o.prototype.$a=function(t){var n,i,e,s,r,o,u,a,t=this.Za(t),c=f.default.T.page_context;return null!=c?(a=void 0,a=h.Po(c)?c.startsWith(l.default.At)?c:l.default.At+c:(i=n="",e=c.query,c=c.fragment,s=h.Ie(t),e&&s.search&&(r=new URLSearchParams(s.search),h.Jo(e)?(r.sort(),n=r.toString()):h.isArray(e)?(o=new URLSearchParams,e.forEach(function(n){var t=r.getAll(n);t.length&&t.forEach(function(t){o.append(n,t)})}),o.sort(),n=o.toString()):h.tc(e)&&(u=new URLSearchParams,r.forEach(function(t,n){e.test(n)&&u.append(n,t)}),u.sort(),n=u.toString()),n=n&&"?"+(n=n.replace(/=$|=(?=&)/g,""))),c&&s.hash&&(i=s.hash),s.pathname+n+i),d.default(v.st,"Custom Page Context: "+a),a):(c=h.Ie(t).pathname,d.default(v.st,"Retrieved Page Context: "+c),this.nc(c))},o.prototype.Co=function(t){t=this.Za(t),t=h.Ie(t).host;return d.default(v.st,"Retrieved Site Context: "+t),t.toLowerCase()},o.prototype.Qa=function(t,n){t=h.Ie(this.Za(t,n)),n=t.origin;return d.default(v.st,"Retrieved parent origin: "+n,t),n},o.prototype.Xa=function(t){var r=h.Ie(t).origin,o=h.Ii(16),u=window.parent;return e.timeout(f.default.W,new Promise(function(i,e){function s(t){var n=t.data;t.source===u&&t.origin===r&&"verify"===n.cmd&&(d.default(v.st,"Origin verification event",t),n.payload.id===o?(c.default.removeEventListener(window,"message",s),i(r)):e("Invalid verification"))}c.default.addEventListener(window,"message",s),u.postMessage(new a.Gi({id:o}),r),d.default(v.st,"Started origin verification",t,r,o)}))},o.prototype.To=function(){var t=window.n4rConfig,n=-1<window.location.host.indexOf("localhost"),i="file:"===window.location.protocol,e=-1<window.location.host.indexOf("cdn");return i||t&&n?"http://localhost:3000":e||!t&&n?window.location.origin:"https://cdn.now4real.com"},o.prototype.nc=function(t){return h.Po(t)?/\/([Hh]ome|[Ii]ndex|[Dd]efault)(\.\w+)?/.test(t)?t.substring(0,t.length-t.split("/").pop().length):t:null},i.default=o},{1:1,13:13,2:2,34:34,35:35,39:39,41:41,43:43,44:44}],33:[function(t,n,i){Object.defineProperty(i,"t",{value:!0}),i.decode=i.ic=void 0;var e=t(41);function s(t){return t.replace(/-/g,"+").replace(/_/g,"/")}function r(t){return decodeURIComponent(atob(t).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""))}i.ic=function(t){return!!t&&e.Po(t)&&/^[^\.\s]+\.[^\.\s]+\.[^\.\s]*$/.test(t)},i.decode=function(t){return(t=t.split("."))?{ec:JSON.parse(r(s(t[0]))),payload:JSON.parse(r(s(t[1]))),signature:t[2]||null}:null}},{41:41}],34:[function(t,n,i){Object.defineProperty(i,"t",{value:!0});var o=t(1),u=t(21),e=t(41),s=t(10),a=t(7),c=t(35),h=t(2),t=(r.prototype.init=function(t,n,i){this.rc=n,this.tn=i,c.default(h.st,"Origins: our -> "+i+", integrator -> "+n),this.oc=t,this.uc()},r.prototype.reset=function(){c.default(h.st,"Listeners resetted"),this.removeEventListener(window,"message",this.ac)},r.prototype.uc=function(){if(!s.test(1))throw new Error("Message API not supported!");this.addEventListener(window,"message",this.ac)},r.prototype.addEventListener=function(t,n,i){document.addEventListener&&t.addEventListener(n,i,!1)},r.prototype.removeEventListener=function(t,n,i){document.removeEventListener&&t.removeEventListener(n,i,!1)},r.prototype.hc=function(t,n){return(n=void 0===n?!1:n)?void 0!==o.default.D.file_name||t===this.rc:t===this.tn},r.prototype.lc=function(t){return e.Mn(t)&&"cmd"in t&&"payload"in t&&"PROXY"===t.iss},r.prototype.fc=function(t){return e.Mn(t)&&"cmd"in t&&"getStoredEmail"===t.cmd},r);function r(){var r=this;this.ac=function(t){var n,i,e=t.data,s=t.origin||t.originalEvent.origin;r.hc(s,!0)&&r.lc(e)?(c.default(h.st,"Proxy message received"),r.oc.As(e.id,e.cmd,e.payload)):r.hc(s)&&r.fc(e)&&(e=e.siteKey,i=void c.default(h.st,"Get email message received",e),e&&(null==(n=a.default.Ye)?void 0:n.Iu())==="n4rAuth@"+e?i=a.default.Ye.getItem(o.default.$):e||(i=u.default.getUser()),i)&&i.email&&t.source.postMessage({email:i.email},s)}}i.default=new t},{1:1,10:10,2:2,21:21,35:35,41:41,7:7}],35:[function(t,n,i){var r=this&&this.__spreadArrays||function(){for(var t=0,n=0,i=arguments.length;n<i;n++)t+=arguments[n].length;for(var e=Array(t),s=0,n=0;n<i;n++)for(var r=arguments[n],o=0,u=r.length;o<u;o++,s++)e[s]=r[o];return e},o=(Object.defineProperty(i,"t",{value:!0}),t(1)),u=t(3);function a(t,n){return n.length>=t?n:n+new Array(t-n.length+1).join(" ")}var c="[NOW4REAL-"+a(o.default.C,o.default.h)+"]";i.default=function(t,n){for(var i=[],e=2;e<arguments.length;e++)i[e-2]=arguments[e];var s=o.default.S;window.console&&s!==u.O.Off&&s<=t&&(s=t!==u.O.Error&&t!==u.O.Warn||void 0===console.error?"log":"error",t=a(o.default.P,u.O[t]),t=c+" "+t+" | "+n,0!==i.length?console[s].apply(console,r([t],i)):console[s](t))}},{1:1,3:3}],36:[function(e,t,u){!function(i){!function(){Object.defineProperty(u,"t",{value:!0});var f=e(43),d=e(44),v=e(3),w=e(41),s=e(33),a=e(2),m=e(7),S=e(1),p=e(21),r=e(22),g=e(13),b=e(39),n=e(10),E=e(4),o=e(34),c="undefined"!=typeof window?window.LS:void 0!==i?i.LS:null,O=e(35),P=e(2),C=/^CONNECTED:(?!STREAM-SENSING)/;function t(){this.dc=!1,this.vc=!1,this.wc=!1,this.mc=null}t.li=function(){return t.fi=t.fi?t.fi:new t},t.prototype.init=function(t,n,i,e,s,r,o){var u=this,t=(this.version=t,this.Ne=n,this.bc=i,this.De=s,this.Ze=r,this.Pe=o,this.Ec=w.Sc(S.default.D.env_subdom),p.default.Du()||this.Ec),n=w.Ie(this.Ec).protocol,i=(this.Oc=n,O.default(P.st,"felsEndpoint",t,n),new c.LightstreamerClient(t,S.default.A)),s=i.connectionOptions,r=(s.setReverseHeartbeatInterval(3e4),s.setSessionRecoveryTimeout(2e3),s.setRetryDelay(4e3),s.setCookieHandlingRequired(!0),e&&(O.default(P.st,"DEMO"),i.connectionDetails.setAdapterSet("DEMO")),{onStatusChange:function(t){var n=t.startsWith(a.default.Et+":")||t===a.default.Ot&&"CONNECTED"===u.Pc,n=(O.default(P.et,t),n?"CONNECTED":"DISCONNECTED");u.Pc!==n&&(u.Cc&&w.we(u.Cc.Fs)&&u.Cc.Fs(n),u.Pc=n),C.test(t)?u.Tc():t===a.default.St&&u.Nc()},onPropertyChange:function(t){var n;"sessionId"===t?(n=u.Ys.getSessionId(),!u.sessionId&&n&&(u.sessionId=n,u.Ys.setUser(u.Dc())),O.default(P.et,t+": "+n)):-1<["user","password"].indexOf(t)&&O.default(P.st,"Changed "+t+" property")},onServerError:function(t,n){var i,e;if(u.dc&&(O.default(P.nt,"onServerError event",t,n),u.Cc))switch(t){case v.zt.UnsupportedClient:null!=(i=u.Cc)&&i.Ws();break;case v.zt.AuthenticationExpired:u.vc||(u.mode===v.qt.JWT?m.default.hn?b.timeout(S.default.B,m.default.ln.send(new g.Li)).then(function(t){O.default(P.st,"obtained new JWT 2",t),u._c(t)}).catch(function(t){O.default(P.nt,t.message),null!=(t=u.Cc)&&t.Gs()}):null!=(i=u.Cc)&&i.Gs():u.mode!==v.qt.SOCIAL&&u.mode!==v.qt.EMAIL||null!=(i=u.Cc)&&i.Bs());break;case v.Yt.WrongCredentials:case v.zt.Unauthorized:u.yc(w.Ic(t,n).reason);break;case v.zt.TemporarilyUnavailable:u.vc||(e=(i=w.Ic(t,n)).redirect,i.siteConf?u.yc(a.default.Vt):u.Nc(e));break;case v.Yt.AllowedSessionCountReached:case v.Yt.SessionCountLimitReached:case v.Yt.ServerTooBusy:case v.Yt.ServerBlocked:u.vc||u.Nc()}}});return i.addListener(r),this.cs=i,this.Ys=i.connectionDetails,i},t.prototype.Ls=function(t){this.Cc=t},t.prototype.ts=function(){this.wc=!0,this.Tc()},t.prototype.Ue=function(t){t&&(this.perms=t,this.Ys)&&this.Ys.getUser()&&this.Ys.setUser(this.Dc())},t.prototype.ps=function(){var e,s=this;return new Promise(function(n,i){s.Mc().then(function(n){var t=S.default.D.no_initial_config,i=s.Ne.get().conf;if(t&&i){if(s.Ac(i))throw new f.default(d.Qt.RELOAD_REQUIRED,JSON.stringify(s.Ne.cn()));if(s.Rc(i))return s.Uc(i).then(function(t){var n;O.default(P.st,"fixing config",t),null!=(n=s.Cc)&&n.qs(t)}).then(function(t){return n})}return n}).then(function(t){var n=t.xc,t=t.kc,i=(e=n,s.Ne.get().auth),i=!s.De&&(n===v.qt.JWT&&1!==i||n!==v.qt.JWT&&1===i);return O.default(P.st,"First connection",n,t,i),s.connect(n,t,i)}).then(function(t){s.dc=!0,s.jc=s.Ne.get().auth,n(t)}).catch(function(t){e!==v.qt.READ_ONLY&&e!==v.qt.N4R&&s.Lc(t)?s.Xe().then(function(t){s.dc=!0,s.jc=s.Ne.get().auth,n(s.mode)}).catch(function(t){i(t)}):s.Fc(t)?i(new f.default(d.Qt.ACCESS_DENIED,t.message)):i(t)})})},t.prototype.Mc=function(){var e=this;return new Promise(function(n,i){e.Ze&&m.default.hn?b.timeout(S.default.B,m.default.ln.send(new g.Li)).then(function(t){O.default(P.st,"obtained first JWT",t),e.mc=m.default.Gc=t,n(e.Jc(t))}).catch(function(t){O.default(P.nt,t.message),i(new f.default(d.Qt.ACCESS_DENIED,t.message))}):n(e.Jc())})},t.prototype.Ke=function(e,s){var r=this;return new Promise(function(n,i){O.default(P.st,"Switching to authenticated",e,s),r.Ue([]),r.disconnect().then(function(t){r.connect(e,s).then(function(t){n(s)}).catch(function(n){r.Lc(n)?r.connect(v.qt.READ_ONLY).then(function(t){i(n)}).catch(function(t){i(t),r.Fc(t)&&r.yc(a.default.Vt)}):(i(n),r.Fc(n)&&r.yc(a.default.Vt))})})})},t.prototype.Xe=function(){var e=this;return new Promise(function(n,i){O.default(P.st,"Switching to unauthenticated"),e.Ue([]),e.disconnect().then(function(t){e.connect(v.qt.READ_ONLY).then(function(t){n()}).catch(function(t){i(t),e.Fc(t)&&e.yc(a.default.Vt)})})})},t.prototype.zs=function(){this.cs.disconnect()},t.prototype.$s=function(){var t;n.Pi()&&(t=p.default.Du(),this.Ys.setServerAddress(t||this.Ec)),this.cs.connect()},t.prototype.Jc=function(t){var n,i=this.Ne.get(),e=i.auth,i=i.siteKey,s=3===e;return s=this.De?(n=v.qt.N4R,S.default.D.n4r_jwt||null):this.Ze?(n=v.qt.JWT,t||S.default.T.custom_auth.jwt):2===e?(t=(m.default.Ye=new r.default(a.default.Ut+"@"+i)).getItem(S.default.K),n=v.qt.NO_REGISTRATION,t?t.token:null):s?(e=(m.default.Ye=new r.default(a.default.Ut+"@"+i)).getItem(S.default.$),n=v.qt.EMAIL,e||null):(n=(t=p.default.getUser())&&!this.Pe?v.qt.SOCIAL:v.qt.READ_ONLY,t&&!this.Pe?t:null),{xc:n,kc:s}},t.prototype.Lc=function(t){return t.code===d.Qt.ACCESS_DENIED},t.prototype.Fc=function(t){return t.code===d.Qt.MISMATCH},t.prototype.Hc=function(t,n,i){void 0===i&&(i=!1);t=t||"",n=n||{};return Object.keys(n).length||(n.site=this.bc,n["x-conf"]=S.default.T),i||(n.sitev=this.Ne.get().version),this.sessionId&&(n.sid=w.Vc(this.sessionId)),this.perms&&(n.perms=this.perms),[this.version,t,JSON.stringify(n,function(t,n){return!0===n?1:!1===n?0:null!==n?n:void 0})].join(a.default.Mt)},t.prototype.Wc=function(t,n,i){var e;if(void 0===i&&(i=!1),t===v.qt.JWT||t===v.qt.N4R){var s=null,r=null;if(n){var o=w.Bc(n,".");if(!o||5!==o.length)throw new f.default(d.Qt.ACCESS_DENIED,"Invalid JWT");r=o.pop(),s=o.join("")}o=this.Hc(s,null,i),s=r}else s=t===v.qt.NO_REGISTRATION?(o=this.Hc(n,null,i),null):t===v.qt.EMAIL?(o=this.Hc((e=n)?e.id:null,null,i),e?e.secret:null):t===v.qt.SOCIAL?(o=this.Hc((e=n).id,null,i),e.secret):(o=this.Hc(null,null,i),null);return[o,s]},t.prototype.Dc=function(){var t=this.Ys.getUser().split(a.default.Mt),n=t[1],t=JSON.parse(t[2]);return this.Hc(n,t)},t.prototype.jr=function(t){if(!this.mc||!s.ic(t))throw new Error("Invalid JWT or missing initial");var n=this.mc,n=s.decode(n).payload,i=s.decode(t).payload,e=n.sub;if(e!==i.sub)throw new Error("'sub' claim changed. It should have been equal to: "+e);e=n.iss;if(e!==i.iss)throw new Error("'iss' claim changed. It should have been equal to: "+e);n=this.Ys.getUser().split(a.default.Mt),i=JSON.parse(n[2]),e=w.Bc(t,"."),n=e.pop(),e=e.join("");this.Ys.setUser(this.Hc(e,i)),this.Ys.setPassword(n),m.default.Gc=t},t.prototype._c=function(t){this.jr(t),null!=(t=m.default.dn)&&t.vu()||this.cs.connect()},t.prototype.Tc=function(){var t;this.wc&&(t=this.Ys.getServerInstanceAddress(),O.default(P.st,"handleFelsSaving",t),t)&&t!==this.Ec&&(O.default(P.st,"control link detected",t),S.default.L&&p.default.Nu(t),this.Ys.setServerAddress(t))},t.prototype.Nc=function(t){var n=this.Ys.getServerAddress(),i=this.cs.getStatus(),e=m.default.dn.vu(),i=(O.default(P.st,"handleFelsSwitch",t,n,i,e,this.Ec),i===a.default.DISCONNECTED);if(t||n!==this.Ec){O.default(P.st,"switching"),p.default._u(),this.cs.disconnect();try{this.Ys.setServerAddress(t?this.Oc+"//"+t+"/":this.Ec)}catch(t){O.default(P.nt,t.message),this.Ys.setServerAddress(this.Ec)}i=!0}i&&!e&&(O.default(P.st,"reconnecting"),this.cs.connect())},t.prototype.qc=function(t){O.default(P.st,"handleConfUpdate",t),this.Ne.update(JSON.stringify(t));var t=this.Jc(m.default.Gc),n=t.xc,t=this.Wc(n,t.kc),i=t[0],t=t[1];return this.Ys.setUser(i),this.Ys.setPassword(t),this.cs.connect(),n},t.prototype.connect=function(c,r,o){var u,h=this,l=(void 0===o&&(o=!1),this.vc=!0,c);return new Promise(function(n,i){function a(t){h.vc=!1,h.cs.removeListener(u),i(t)}u={onStatusChange:function(t){C.test(t)&&(h.mode=l,t=l,h.vc=!1,h.cs.removeListener(u),n(t))},onServerError:function(t,n){O.default(P.nt,n,t);var i=w.Ic(t,n);switch(t){case v.Yt.WrongCredentials:l===v.qt.SOCIAL?p.default.mo():l===v.qt.EMAIL&&(null!=(u=m.default.Ye)&&u.removeItem(S.default.$),null!=u)&&u.removeItem(S.default.Z),a(new f.default(d.Qt.ACCESS_DENIED,i));break;case v.zt.Unauthorized:a(new f.default(d.Qt.ACCESS_DENIED,i));break;case v.zt.AuthenticationExpired:c===v.qt.JWT&&m.default.hn?b.timeout(S.default.B,m.default.ln.send(new g.Li)).then(function(t){O.default(P.st,"obtained new JWT 1",t),h._c(t)}).catch(function(t){O.default(P.nt,t.message),a(new f.default(d.Qt.ACCESS_DENIED,i))}):a(new f.default(d.Qt.ACCESS_DENIED,i));break;case v.zt.UnsupportedClient:a(new f.default(d.Qt.TECHNICAL_PROBLEM,"Unsupported client"));break;case v.zt.UnsupportedBrowser:a(new f.default(d.Qt.TECHNICAL_PROBLEM,"Unsupported browser"));break;case v.zt.TemporarilyUnavailable:var e,s,r,o=i.siteConf,u=i.redirect;o?(e=o.s,s=o.a,r=o.c||{},e?!s&&(!h.dc&&c===v.qt.JWT||h.dc&&s!==h.jc&&c!==v.qt.N4R)?a(new f.default(d.Qt.MISMATCH,"This site requires social authentication")):1===s&&c!==v.qt.JWT&&c!==v.qt.N4R?a(new f.default(d.Qt.MISMATCH,"This site requires JWT authentication")):2===s&&(!h.dc&&c===v.qt.JWT||h.dc&&s!==h.jc&&c!==v.qt.N4R)?a(new f.default(d.Qt.MISMATCH,"This site requires No Registration login")):3===s&&(!h.dc&&c===v.qt.JWT||h.dc&&s!==h.jc&&c!==v.qt.N4R)?a(new f.default(d.Qt.MISMATCH,"This site requires Email login")):!h.dc&&h.Ac(r)?a(new f.default(d.Qt.RELOAD_REQUIRED,JSON.stringify(o))):!h.dc&&h.Rc(r)?h.Uc(r).then(function(t){var n;O.default(P.st,"obtained new config",t),null!=(n=h.Cc)&&n.qs(t),l=h.qc(o)}).catch(function(t){O.default(P.st,t),a(new f.default(d.Qt.TECHNICAL_PROBLEM,"unable to refresh config"))}):l=h.qc(o):a(E.$t)):h.Nc(u);break;case v.Yt.AllowedSessionCountReached:case v.Yt.SessionCountLimitReached:case v.Yt.ServerTooBusy:case v.Yt.ServerBlocked:h.Nc();break;default:a(new f.default(d.Qt.TECHNICAL_PROBLEM,i))}}},h.cs.addListener(u);try{var t=h.Wc(c,r,o),e=t[0],s=t[1];h.Ys.setUser(e),h.Ys.setPassword(s),O.default(P.st,c+" attempt",r,e,s),o=!1,h.cs.connect()}catch(t){a(t)}})},t.prototype.disconnect=function(){var e=this;return new Promise(function(n){var i;e.cs.getStatus()===a.default.DISCONNECTED?n():(i={onStatusChange:function(t){t===a.default.DISCONNECTED&&(e.cs.removeListener(i),n())}},e.cs.addListener(i),e.cs.disconnect())})},t.prototype.yc=function(t){var n;switch(t){case a.default.Vt:null!=(n=this.Cc)&&n.Hs();break;case a.default.Wt:null!=(n=this.Cc)&&n.Vs();break;default:this.mode===v.qt.JWT&&null!=(n=this.Cc)&&n.Gs()}},t.prototype.Ac=function(t){var n,i,e,s,r,o,u,a,c,h,l,f,d,v,w,m,p,g,b,E;try{return O.default(P.st,"requiresReload",t),this.De||top===self?!1:(u=S.default._,a=S.default.T,c=u.target,h=a.target,l=null!=(n=t.target)?n:"widget",f=u.page_context,d=a.page_context,v=null!=(i=t.page_context)?i:null,w=u.param_overriding,m=a.param_overriding,p=null!=(e=t.param_overriding)&&e,g=null==(s=u.widget)?void 0:s.container,b=a.widget.container,E=null!=(o=null==(r=t.widget)?void 0:r.container)?o:null,void 0===c&&l!==h||void 0===f&&v!==d||void 0===w&&p!==m||void 0===g&&E!==b)}catch(t){return O.default(P.nt,"requiresReload error",t),!1}},t.prototype.Rc=function(t){try{return O.default(P.st,"requiresConfigUpdate",t),!this.De&&top!==self}catch(t){return O.default(P.nt,"requiresConfigUpdate error",t),!1}},t.prototype.Uc=function(t){var r=window.parent;return b.timeout(S.default.W,new Promise(function(i,e){function s(t){var n=t.data;if(t.source===r&&"updateConfig"===n.cmd){O.default(P.st,"Config update event",t),o.default.removeEventListener(window,"message",s);try{i(n.ih)}catch(t){e("Invalid config update")}}}o.default.addEventListener(window,"message",s),m.default.ln.send(new g.ji(t))}))},u.default=t}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,10:10,13:13,2:2,21:21,22:22,3:3,33:33,34:34,35:35,39:39,4:4,41:41,43:43,44:44,7:7}],37:[function(t,n,i){Object.defineProperty(i,"t",{value:!0});var o=t(3),s=t(41),u=t(39),a=t(2),c=t(1),h=t(43),l=t(44),f=t(35),d=t(2);function e(){}e.li=function(){return e.fi=e.fi?e.fi:new e},e.prototype.init=function(t,n){this.cs=t,this.getContext=n},e.prototype.uo=function(t,n,i,e){t={beforeMessageId:t,maxMessageCount:n=void 0===n?10:n};return e&&(t.updatedAfter=e),i&&(t.skipUserIds=i),this.Yc(o.Kt.MESSAGE_GET,t)},e.prototype.Fe=function(){return this.Yc(o.Kt.GET_AUTH_INFO,{})},e.prototype.Uo=function(t){return this.Yc(o.Kt.DELETE_PASSWORD,{password:t})},e.prototype.Lo=function(t,n){t={payload:t},n=n&&n.replyTo;return n&&(t.reply=n),this.Yc(o.Kt.MESSAGE_SEND,t)},e.prototype.Fo=function(t){return this.Yc(o.Kt.MESSAGE_DELETE,{id:t})},e.prototype.Go=function(){return this.Yc(o.Kt.CHAT_FLUSH,{})},e.prototype.Ho=function(t){return this.Yc(o.Kt.CHAT_ENABLE,{enable:t})},e.prototype.Vo=function(t){return this.Yc(o.Kt.MUTE_USER_GET,{userId:t})},e.prototype.Bo=function(t,n){return this.Yc(o.Kt.MUTE_USER_SET,{userId:t,duration:n})},e.prototype.qo=function(t,n,i){t={id:t,reason:n};return i&&(t.comment=i),this.Yc(o.Kt.REPORT_CHAT_MESSAGE,t)},e.prototype.Lu=function(t){return this.Yc(o.Kt.USER_PREFERENCE_SET,{value:t})},e.prototype.zc=function(t){return this.Yc(o.Kt.LOG,{msg:t})},e.prototype.Yo=function(){return this.Yc(o.Kt.USER_CONSENT_SET,{})},e.prototype.Lr=function(t){return this.Yc(o.Kt.JWT_REFRESH,{jwt:t},{Kc:!0})},e.prototype.Ko=function(t,n,i){return this.Yc(o.Kt.POLL_NEW,{question:t,options:n,maxVotes:i})},e.prototype.Xo=function(t){return this.Yc(o.Kt.POLL_CLOSE,{remove:t})},e.prototype.Qo=function(){return this.Yc(o.Kt.POLL_VOTE_GET,{})},e.prototype.$o=function(t){return this.Yc(o.Kt.POLL_VOTE_SET,{vote:t})},e.prototype.Yc=function(t,n,i){var e=this.getContext(),e=c.default.T.scope===a.default.It&&-1<[o.Kt.MESSAGE_SEND,o.Kt.MESSAGE_DELETE,o.Kt.CHAT_FLUSH,o.Kt.CHAT_ENABLE,o.Kt.MUTE_USER_GET,o.Kt.MUTE_USER_SET,o.Kt.REPORT_CHAT_MESSAGE,o.Kt.USER_CONSENT_SET,o.Kt.POLL_NEW,o.Kt.POLL_CLOSE,o.Kt.POLL_VOTE_GET,o.Kt.POLL_VOTE_SET,o.Kt.MESSAGE_GET].indexOf(t)?a.default.Ft+"/":""+a.default.Gt+e.Se,s=this.Xc(e,o.Kt[t],n),r=(f.default(d.st,"RPC ("+o.Kt[t]+")",s,i),(null!=i&&i.Kc?this.$c:this.Qc).bind(this));return null!=i&&i.retryOnAbort?u.retry(function(){return r(s)},{rn:"message",on:["onAbort"],un:5,delay:500}):r(s)},e.prototype.Xc=function(t,n,i){return t+a.default.Mt+n+a.default.Mt+JSON.stringify(i)},e.prototype.Qc=function(t){var s=this;return new Promise(function(i,e){s.cs.sendMessage(t,"s",null,{onDeny:function(t,n,i){f.default(d.st,"onDeny listener call",t,n,i),s.Zc(n,i,e)},onProcessed:function(t,n){f.default(d.st,"onProcessed listener call",t,n),s.th(t,n,i,e)},onDiscarded:function(t){f.default(d.it,"onDiscarded listener call",t),e(new h.default(l.Qt.TECHNICAL_PROBLEM,"onDiscarded"))},onError:function(t){f.default(d.nt,"onError listener call",t),e(new h.default(l.Qt.TECHNICAL_PROBLEM,"onError"))},onAbort:function(t,n){f.default(d.st,"onAbort listener call",t,n),e(new h.default(l.Qt.TECHNICAL_PROBLEM,"onAbort"))}},!0)})},e.prototype.$c=function(i){var e=this;return new Promise(function(t,n){try{e.cs.sendMessage(i,"UNORDERED_MESSAGES",null,null,!1),t()}catch(t){n(new h.default(l.Qt.TECHNICAL_PROBLEM,t.message))}})},e.prototype.Zc=function(t,n,i){try{switch(t){case o.zt.TemporarilyUnavailable:i(new h.default(l.Qt.SERVICE_UNAVAILABLE,"the service is temporarily unavailable"));break;case o.zt.Unauthorized:var e=s.Ic(t,n);i(new h.default(l.Qt.NOT_AUTHORIZED,e));break;default:i(new h.default(l.Qt.TECHNICAL_PROBLEM,t.toString()))}}catch(t){f.default(d.nt,t),i(new h.default(l.Qt.TECHNICAL_PROBLEM,"protocol mismatch"))}},e.prototype.th=function(t,n,i,e){try{var s,r,o,u=n?JSON.parse(n):null;this.nh(t)?(s=u.publish,r=u.moderation,o=u.error,s?i(u):e(o||r)):(this.eh(t)||this.sh(t)||this.rh(t))&&(o=u.error)?e(o):i(u)}catch(t){f.default(d.nt,t),e(new h.default(l.Qt.TECHNICAL_PROBLEM,"protocol mismatch"))}},e.prototype.oh=function(t){return t.split(a.default.Mt)[1]},e.prototype.nh=function(t){return this.oh(t)===o.Kt[o.Kt.MESSAGE_SEND]},e.prototype.eh=function(t){return this.oh(t)===o.Kt[o.Kt.REPORT_CHAT_MESSAGE]},e.prototype.sh=function(t){return this.oh(t)===o.Kt[o.Kt.USER_PREFERENCE_SET]},e.prototype.rh=function(t){return[o.Kt[o.Kt.POLL_NEW],o.Kt[o.Kt.POLL_CLOSE],o.Kt[o.Kt.POLL_VOTE_GET],o.Kt[o.Kt.POLL_VOTE_SET]].includes(this.oh(t))},i.default=e},{1:1,2:2,3:3,35:35,39:39,41:41,43:43,44:44}],38:[function(t,n,i){Object.defineProperty(i,"t",{value:!0});var e=t(40),s=t(35),r=t(2),a="ABORT_RUNNING";function o(t,n,i){void 0===t&&(t=!1),void 0===n&&(n=1),this.uh=[],this.ah=0,this.hh=n,(this.lh=t)&&(this.fh=new e.default(i)),this.name=i||"",this.dh=function(){}}o.prototype.next=function(){this.ah--,0<this.uh.length?this.uh.shift()():this.dh()},o.prototype.add=function(o){var u=this;return new Promise(function(s,r){function t(){u.ah++;var n,i,e=!1;u.lh&&(n=Date.now(),i=function(t){n<t&&(e=!0,r(new Error("Task aborted")),u.fh.unsubscribe(a,i),u.next())},u.fh.subscribe(a,i)),o().then(function(t){e||(s(t),u.lh&&u.fh.unsubscribe(a,i),u.next())},function(t){e||(r(t),u.lh&&u.fh.unsubscribe(a,i),u.next())})}u.ah<u.hh?t():u.uh.push(t)})},o.prototype.vo=function(){this.lh&&(s.default(r.st,"abortRunning",this.fh.wh(a),this.name),this.fh.publish(a,Date.now()))},o.prototype.ea=function(){return this.ah},i.default=o},{2:2,35:35,40:40}],39:[function(t,n,i){Object.defineProperty(i,"t",{value:!0}),i.timeout=i.retry=i.pause=void 0;var h=t(35),l=t(2);function f(n){return new Promise(function(t){return setTimeout(t,n)})}i.pause=f,i.retry=function e(s,r){var o=r.rn||"code",u=r.on||"*",a=r.un||3,c=r.delay||1e3;return s().catch(function(t){var n,i=t[o];return 1<a&&i&&(-1<u.indexOf(i)||"*"===u)?(h.default(l.st,"Retry "+s+", remaining attempts: "+(n=a-1)+", code: "+i),r.un=n,f(c).then(function(){return e(s,r)})):Promise.reject(t)})},i.timeout=function(i,t){var e,n=new Promise(function(t,n){e=setTimeout(function(){n(new Error("Timeout after "+i+" ms"))},i)});return Promise.race([t,n]).then(function(t){return clearTimeout(e),t})}},{2:2,35:35}],40:[function(t,n,i){Object.defineProperty(i,"t",{value:!0});var e={}.hasOwnProperty,r=t(35),o=t(2);function s(t){this.mh={},this.name=t||""}s.prototype.subscribe=function(t,n){var i;r.default(o.st,"PubSub subscribe",t,this.name,null==(i=this.mh[t])?void 0:i.length),e.call(this.mh,t)||(this.mh[t]=[]),this.mh[t].push(n)},s.prototype.unsubscribe=function(t,n){var i,e=null==(i=this.mh[t])?void 0:i.length;if(e){r.default(o.st,"PubSub unsubscribe",t,this.name,e);for(var s=0;s<e;s++)if(this.mh[t][s]===n){this.mh[t].splice(s,1),1===e&&delete this.mh[t];break}}},s.prototype.ca=function(t){delete this.mh[t]},s.prototype.publish=function(t,n){e.call(this.mh,t)&&this.mh[t].forEach(function(t){t(void 0!==n?n:{})})},s.prototype.wh=function(t){return this.mh[t]?this.mh[t].length:null},i.default=s},{2:2,35:35}],41:[function(t,n,i){Object.defineProperty(i,"t",{value:!0}),i.wa=i.kr=i.Ca=i.Ur=i.xo=i.Gr=i.qr=i.Br=i.Bc=i.getTime=i.Ii=i.Ic=i.Rr=i.Oo=i.Tn=i.tc=i.Po=i.Wo=i.isArray=i.Jo=i.we=i.Mn=i.So=i.Jr=i.rr=i.Vc=i.jo=i.au=i.Sc=i.Ps=i.Ts=i.Cs=i.Ss=i.Ie=i.ph=i.gh=void 0;var s=t(35),r=t(2),o=t(1),u=t(2);function a(t,n){return n?n===u.default.wt&&t.endsWith(":80")||"https"===n&&t.endsWith(":443"):(s.default(r.nt,"Undefined protocol"),!1)}function c(t){return t.replace(/\:[0-9]{1,4}(.*)/,"$1")}function h(t){return("0"+t.toString(16)).substr(-2)}i.gh=a,i.ph=c,i.Ie=function(t){var n,i,e,s,r,o,u;if(t)return(n=document.createElement("a")).href=t,t=n.port,e=n.hostname,s=n.pathname,r=n.search,o=n.hash,u=n.origin,a(i=n.host,(n=n.protocol).slice(0,-1))&&(i=c(i)),{protocol:n,host:i,hostname:e,port:t,pathname:s=s.startsWith("/")?s:"/"+s,origin:u=u||n+"//"+i,search:r,hash:o};throw new Error("Empty URL")},i.Ss=function(){return decodeURIComponent(location.hash.substring(1))},i.Cs=function(t){var n=["cdn.",""!==t?t+".":t,"now4real.com"].join("");return s.default(r.st,"Computed cdn hostname for "+t+" env: "+n),u.default.gt+"://"+n},i.Ts=function(t){return this.Cs(t)+"/user-app/"},i.Ps=function(t){var n=["api.",""!==t?t+".":t,"now4real.com"].join("");return s.default(r.st,"Computed api gateway hostname for "+t+" env: "+n),u.default.gt+"://"+n+":443"},i.Sc=function(t){if(void 0===t)throw new Error("env err: "+t);"staging"===t||""===t?(e=o.default.I,i=["fels.",""!==t?t+".":t,"now4real.com"].join(""),n=o.default.M):"devops"===t?(e="http",i="fels.localtest.me",n="4000"):"ci-devops"===t&&(e=u.default.wt,i="n4r-fels.now4real-client-integration-test.svc.cluster.local",n="80");var n,i,e=e+"://"+i+":"+n+"/";return s.default(r.st,"Computed fels for "+t+" env: "+e),e},i.au=function(t){return null==t||void 0===t.closed},i.jo=function(t){return t.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"_").length},i.Vc=function(t){return t.charAt(0).toLowerCase()+t.slice(1)},i.rr=function(t){Promise.resolve().then(function(){t()})},i.Jr=function(t,n,i){return t={id:t.id,name:t.nick,pic:t.icon,provider:t.provider},n&&(t.role=n),i&&(t.badge=i),t},i.So=function(t,n,i,e,s){return(t=this.Jr(t,i,e)).consentGiven=n,s&&(t.preferences=s),t},i.Mn=function(t){return null!==t&&"object"==typeof t&&!Array.isArray(t)},i.we=function(t){return"function"==typeof t},i.Jo=function(t){return"boolean"==typeof t},i.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},i.Wo=function(t){return"number"==typeof t||"object"==typeof t&&t.constructor===Number},i.Po=function(t){return"string"==typeof t},i.tc=function(t){return t instanceof RegExp},i.Tn=function(t){return JSON.parse(JSON.stringify(t))},i.Oo=function(t,n){return JSON.stringify(t)===JSON.stringify(n)},i.Rr=function(t,n){return t.bind(n)},i.Ic=function(t,n){return 0<t?n:JSON.parse(n)},i.Ii=function(t){var n;if(void 0===t&&(t=8),window.crypto&&window.crypto.getRandomValues&&Uint8Array)return n=new Uint8Array((t||40)/2),window.crypto.getRandomValues(n),Array.prototype.slice.call(n).map(h).join("");for(var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",s=0;s<t;s++)e+=i.charAt(Math.floor(Math.random()*i.length));return e},i.getTime=function(){return(new Date).getTime()},i.Bc=function(t,n){for(var i=t.split(n),e=i.length;1<e--;)i.splice(e,0,n);return i},i.Br=function(t){if(!t||!/^\d+(W|D|h|m)$/.test(t))throw new Error("Invalid duration");var n;switch((t=t.split("")).pop()){case"W":n="WEEKS";break;case"D":n="DAYS";break;case"h":n="HOURS";break;case"m":n="MINUTES"}return{value:Number(t.join("")),unit:n}},i.qr=function(t,n){return t*{WEEKS:604800,DAYS:86400,HOURS:3600,MINUTES:60}[n]},i.Gr=function(t,n,i,e){var s=null;switch(t){case"M":s=u.default.jt;break;case"G":s=u.default.Lt}return{role:s,badge:null!==n&&i&&e?{label:n,textColor:"#"+i,backgroundColor:"#"+e}:null}},i.xo=function(t,n){var t=t.snapshot,i=null;return n?n===u.default.jt?i=t.messageMaxLengthModerator:n===u.default.Lt&&(i=t.messageMaxLengthGuest):i=t.messageMaxLength,null!==i?i:o.default.F},i.Ur=function(t){return t=atob(t),Array.from(t).map(function(t){return t.charCodeAt(0)})},i.Ca=function(t,n){var i,t=null==t?void 0:t.match(/.{2}/g),e=null==n?void 0:n.split(""),s={};return t&&e&&(i=0,t.forEach(function(t,n){n=e[n].charCodeAt(0)-32;i+=s[t]=n=0===n?.5:n}),Object.keys(s).forEach(function(t){s[t]=s[t]/i})),s},i.kr=function(t){return t?parseInt(t,16):null},i.wa=function(t){return t?t.toString(16):null}},{1:1,2:2,35:35}],42:[function(t,n,i){Object.defineProperty(i,"t",{value:!0});var e=t(10),s=t(1),r=t(35),o=t(2);function u(t){var n=this;if(this.bh=null,this.Is=null,this.Ms=null,this.visible=null,this.Eh=null,this.Sh=null,this.Oh=function(){n.visible=n.he(),n.Sh||n.Ph()},!e.test(2))throw new Error("Visibility API not supported!");t.Is&&(this.Is=t.Is),t.Ms&&(this.Ms=t.Ms),this.bh=e.Ti(),this.visible=this.Eh=this.he(),document.addEventListener(this.bh.visibilityChange,this.Oh)}u.prototype.Ph=function(){var n=this,t=this.Ch(this.visible);this.Sh=t?setTimeout(function(t){n.Ph()},s.default.q):null},u.prototype.Ch=function(t){var n;return t!==this.Eh&&(r.default(o.st,"notify",t,this.Eh,this.Sh),t?null!=(n=this.Ms)&&n.call(this):null!=(n=this.Is)&&n.call(this),this.Eh=t,!0)},u.prototype.reset=function(){document.removeEventListener(this.bh.visibilityChange,this.Oh)},u.prototype.he=function(){return!document[this.bh.hidden]},i.default=u},{1:1,10:10,2:2,35:35}],43:[function(t,n,i){function e(t,n){this.code=t,this.message=n}Object.defineProperty(i,"t",{value:!0}),e.prototype.toString=function(){return this.code+" - "+this.message},i.default=e},{}],44:[function(t,n,i){var e;Object.defineProperty(i,"t",{value:!0}),i.ci=i.Qt=void 0,(e=i.Qt||(i.Qt={})).ABORTED="ABORTED",e.ACCESS_DENIED="ACCESS_DENIED",e.ALREADY_PRESENT="ALREADY_PRESENT",e.ALREADY_REPORTED="ALREADY_REPORTED",e.ALREADY_STARTED="ALREADY_STARTED",e.BLOCKED="BLOCKED",e.CANNOT_MODERATE="CANNOT_MODERATE",e.CHAT_DISABLED="CHAT_DISABLED",e.CLOSED="CLOSED",e.CREDIT_EXHAUSTED="CREDIT_EXHAUSTED",e.CURRENTLY_DISABLED="CURRENTLY_DISABLED",e.DISCONNECTED="DISCONNECTED",e.INVALID_ARGUMENTS="INVALID_ARGUMENTS",e.INVALID_CALL="INVALID_CALL",e.MISMATCH="MISMATCH",e.NOT_AUTHENTICATED="NOT_AUTHENTICATED",e.NOT_AUTHORIZED="NOT_AUTHORIZED",e.NOT_FOUND="NOT_FOUND",e.QUOTA_EXCEEDED="QUOTA_EXCEEDED",e.RELOAD_REQUIRED="RELOAD_REQUIRED",e.SERVICE_UNAVAILABLE="SERVICE_UNAVAILABLE",e.TECHNICAL_PROBLEM="TECHNICAL_PROBLEM",e.TOO_FREQUENT="TOO_FREQUENT",e.USER_MUTED="USER_MUTED",e.CHATBOT="CHATBOT",(e=i.ci||(i.ci={})).AUTHORIZATION="AUTHORIZATION",e.CONNECTION_STATUS="CONNECTION_STATUS",e.COUNTER_CHAT_MESSAGES="COUNTER_CHAT_MESSAGES",e.COUNTER_CHAT_TYPING="COUNTER_CHAT_TYPING",e.COUNTER_PAGE_CHATTERS="COUNTER_PAGE_CHATTERS",e.COUNTER_PAGE_VIEWERS="COUNTER_PAGE_VIEWERS",e.COUNTER_SITE_CHATTERS="COUNTER_SITE_CHATTERS",e.COUNTER_SITE_VIEWERS="COUNTER_SITE_VIEWERS",e.HEATMAP_PAGE_VIEWERS="HEATMAP_PAGE_VIEWERS",e.HEATMAP_SITE_VIEWERS="HEATMAP_SITE_VIEWERS",e.LIST_CHAT_MESSAGES="LIST_CHAT_MESSAGES",e.LIST_CHAT_TYPING="LIST_CHAT_TYPING",e.LOGIN_STATUS="LOGIN_STATUS",e.PARAMETERS="PARAMETERS",e.POLL="POLL",e.POLL_STATUS="POLL_STATUS",e.RANKING_PAGE_CHATTERS="RANKING_PAGE_CHATTERS",e.RANKING_PAGE_VIEWERS="RANKING_PAGE_VIEWERS"},{}],45:[function(t,n,i){Object.defineProperty(i,"t",{value:!0}),i.Ts=i.Os=void 0,i.Os=function(t,n){var i,e,s,r=(t=JSON.parse(t)).config.page_context;return(r=r&&r.query)&&("string"==typeof(s=r)||s instanceof String)&&(i=s=void 0,s=(e=r.match(/.*\/([igmsuy]+)$/))?(i=e[1],r.slice(1,-(i.length+1))):(i="",r.slice(1,-1)),t.config.page_context.query=new RegExp(s,i)),n&&"fn"===(null==(e=t.config.custom_auth)?void 0:e.jwt)&&(t.config.custom_auth.jwt=n.custom_auth.jwt),t},i.Ts=function(t,n,i){var e=t+"#/"+n;return["site","lang","action","userId","siteKey","provider","wl","cm","bgColor","logo"].forEach(function(t,n){null!=i&&i[t]&&(e+=(n?"&":"?")+t+"="+encodeURIComponent(i[t]))}),e}},{}]},{},[16]);